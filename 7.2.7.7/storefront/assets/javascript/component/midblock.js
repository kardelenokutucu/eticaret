;(function($,w){'use strict';if(!w.jQuery){throw 'Ideasoft: jQuery not found';}
w.IdeaApp.midblock={currentOffset:1,currentTab:1,tabClass:'.tabbed-midblocks-container',blockLength:null,init:function(){this.eventListener();this.useTabBlock();},useTabBlock:function(){var self=IdeaApp.midblock;IdeaApp.plugins.tab(self.tabClass,function(){self.onStart.call(this);},function(){self.beforeClick.call(this);},function(){self.onClick.call(this);});},onStart:function(){var self=IdeaApp.midblock,$self=$(this);var block=$self.find('[data-tab-index]').eq(0).data('tab-index');self.currentTab=block;IdeaApp.plugins.loading.add($self.find('[data-tab-content='+block+']'));IdeaApp.midblock.tabAjax(block,1,function(result){IdeaApp.plugins.loading.remove($self.find('[data-tab-content='+block+']'));$self.find('[data-tab-content='+block+']').html(result.template);self.blockLength=Math.ceil(result.count/result.limit);self.controlButtons();});},controlButtons:function(){var self=IdeaApp.midblock;if(self.blockLength==0){$(self.tabClass+' [data-selector="prev-page"]').addClass('passive');$(self.tabClass+' [data-selector="next-page"]').addClass('passive');}else{if(self.currentOffset==1){$(self.tabClass+' [data-selector="prev-page"]').addClass('passive');}else{$(self.tabClass+' [data-selector="prev-page"]').removeClass('passive');}
if(self.currentOffset==this.blockLength){$(self.tabClass+' [data-selector="next-page"]').addClass('passive');}else{$(self.tabClass+' [data-selector="next-page"]').removeClass('passive');}}},beforeClick:function(){var self=IdeaApp.midblock,$self=$(this),tabIndex=$self.attr('data-tab-index');$self.parents(self.tabClass).find('[data-tab-content='+tabIndex+']').html('');IdeaApp.plugins.loading.add($self.parents(self.tabClass).find('[data-tab-content='+tabIndex+']'));$self.addClass('disabled');},onClick:function(){var self=IdeaApp.midblock,$self=$(this);self.beforeClick();self.currentOffset=1;self.currentTab=parseInt($self.attr('data-tab-index'));IdeaApp.midblock.tabAjax(self.currentTab,self.currentOffset,function(result){IdeaApp.plugins.loading.remove($self.parents(self.tabClass).find('[data-tab-content='+self.currentTab+']'));$self.parents(self.tabClass).find('[data-tab-content='+self.currentTab+']').html(result.template);self.blockLength=Math.ceil(result.count/result.limit);self.controlButtons();$self.removeClass('disabled');});},prevTab:function(){var self=IdeaApp.midblock,$self=$(this),container=$self.parents(self.tabClass);var prevTab=$('[data-tab-index='+self.currentTab+']').prev().attr('data-tab-index');container.find('[data-tab-index='+prevTab+']').click();},nextTab:function(){var self=IdeaApp.midblock,$self=$(this),container=$self.parents(self.tabClass);var nextTab=$('[data-tab-index='+self.currentTab+']').next().attr('data-tab-index');container.find('[data-tab-index='+nextTab+']').click();},prevPage:function(){var self=IdeaApp.midblock,$self=$(this);if(self.currentOffset==1){return false;}else{$self.addClass('disabled');self.currentOffset--;IdeaApp.midblock.tabAjax(self.currentTab,self.currentOffset,function(result){$self.parents(self.tabClass).find('[data-tab-content='+self.currentTab+']').html(result.template);self.controlButtons();$self.removeClass('disabled');});}},nextPage:function(){var self=IdeaApp.midblock,$self=$(this);if(self.currentOffset<self.blockLength){$self.addClass('disabled');self.currentOffset++;IdeaApp.midblock.tabAjax(self.currentTab,self.currentOffset,function(result){$self.parents(self.tabClass).find('[data-tab-content='+self.currentTab+']').html(result.template);self.controlButtons();$self.removeClass('disabled');});}},tabAjax:function(block,offset,callback){IdeaApp.helpers.ajaxRequest({url:IdeaApp.routing.generate("/tabli-vitrin"),data:"midBlock="+block+"&offset="+offset,success:function(result){callback(result);}});},eventListener:function(){var self=this;$(document).on('click',self.tabClass+' [data-selector="prev-page"]',function(){self.prevPage.call(this);});$(document).on('click',self.tabClass+' [data-selector="next-page"]',function(){self.nextPage.call(this);});$(document).on('click',self.tabClass+' [data-selector="prev-tab"]',function(){self.prevTab.call(this);});$(document).on('click',self.tabClass+' [data-selector="next-tab"]',function(){self.nextTab.call(this);});}}}(jQuery,window));