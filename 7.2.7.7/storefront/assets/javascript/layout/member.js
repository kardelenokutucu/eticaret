;(function($,w){'use strict';if(!w.$){throw 'Ideasoft: $ not found';}
w.IdeaApp[IdeaApp.helpers.getRouteGroup()]={init:function(){IdeaApp.helpers.initializePage();this.eventListener();},index:{init:function(){}},signup:{init:function(){this.afterInit();this.validateForm();this.eventListener();},afterInit:function(){IdeaApp.helpers.maskPhone([$('input[name="cell"]')]);IdeaApp.helpers.maskDate($('input[name="birthdate"]'));},validateForm:function(){$('[data-selector="signup-form"]').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',rules:{firstname:{required:true,minlength:2,maxlength:50},surname:{required:true,minlength:2,maxlength:50},email:{required:true,email:{depends:function(){$(this).val($.trim($(this).val()));return true;}},maxlength:240},s_pass:{required:true,minlength:6,maxlength:16,regex:/^(?=.*[0-9])(?=.*[a-zA-Z])[a-zA-Z0-9!\.@#$%&]{6,16}$/,alphanumeric:true},s_pass2:{required:($('input[name="s_pass2"]').attr('data-required')==1?true:false),minlength:6,maxlength:16,alphanumeric:true,regex:($('input[name="s_pass2"]').attr('data-required')==1?/^(?=.*[0-9])(?=.*[a-zA-Z])[a-zA-Z0-9!\.@#$%&]{6,16}$/:undefined),equalTo:($('input[name="s_pass2"]').attr('data-required')==1?'input[name=s_pass]':undefined)},'gender[]':{required:($('input[name="gender[]"]').attr('data-required')==1?true:false)},cell:{required:true,phoneValid:true},birthdate:{required:($('input[name="birthdate"]').attr('data-required')==1?true:false),minlength:10,maxlength:10},'agreement[]':{required:true},'personalDataAgreement[]':{required:true},},messages:{firstname:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="firstname"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="firstname"]')+" en az 2 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="firstname"]')+" en fazla 50 karakter olmalıdır."},surname:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="surname"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="surname"]')+" en az 2 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="surname"]')+" en fazla 50 karakter olmalıdır."},email:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="email"]')+" giriniz.",email:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="email"]')+" uygun formatta olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="email"]')+" en fazla 250 karakter olmalıdır."},s_pass:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="s_pass"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="s_pass"]')+" en az 6 karakter olmalıdır, bir harf ve rakam içermelidir.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="s_pass"]')+" en fazla 16 karakter olmalıdır.",alphanumeric:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="s_pass"]')+" yalnızca harf ve rakamlardan oluşmalıdır.",regex:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="s_pass"]')+" uzunluğu en az 6 hane sadece harf ve rakamdan oluşmalıdır."},s_pass2:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="s_pass2"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="s_pass2"]')+" en az 6 karakter olmalıdır, bir harf ve rakam içermelidir.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="s_pass2"]')+" en fazla 16 karakter olmalıdır.",equalTo:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="s_pass2"]')+" ve "+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="s_pass2"]')+" alanları aynı olmalıdır.",alphanumeric:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="s_pass2"]')+" yalnızca harf ve rakamlardan oluşmalıdır.",regex:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="s_pass2"]')+" uzunluğu en az 6 hane sadece harf ve rakamdan oluşmalıdır."},'gender[]':{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="gender[]"]')+" giriniz."},cell:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="cell"]')+" giriniz.",phoneValid:"Lütfen geçerli bir "+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="cell"]')+" giriniz."},birthdate:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="birthdate"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="birthdate"]')+" en az 10 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="signup-form"] input[name="birthdate"]')+" en fazla 10 karakter olmalıdır."},'agreement[]':{required:"Lütfen Üyelik sözleşmesi alanını boş bırakmayınız."},'personalDataAgreement[]':{required:"Lütfen Kişisel Verilerin Korunması alanını boş bırakmayınız."}},errorPlacement:function(error,element){if(element.attr("type")=="radio"){element.parents('.radio-custom-groups').after(error)}else if(element.attr("type")=="checkbox"){element.parents('.checkbox-custom-groups').after(error)}else if(element.attr("data-selector")=="birth-date"){element.parents('.input-group').after(error);}else{element.after(error);}},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();},highlight:function(element){$(element).addClass('validate-error');if(element.type!=="checkbox"&&element.type!=='radio'){return;}
$(element).parent().siblings().find('input[type="checkbox"], input[type="radio"]').addClass('validate-error');},unhighlight:function(element){$(element).removeClass('validate-error');if(element.type!=="checkbox"&&element.type!=='radio'){return;}
$(element).parent().siblings().find('input[type="checkbox"], input[type="radio"]').removeClass('validate-error');}});$.validator.addMethod('regex',function(value,element,regexp){return IdeaApp.helpers.checkRegex(value,element,regexp)});$.validator.addMethod('email',function(email){return IdeaApp.helpers.checkEmail(email);});$.validator.addMethod('phoneValid',function(value){return IdeaApp.helpers.checkPhone(value);});IdeaApp.helpers.addCustomizationFormRules($('[data-selector="signup-form"]'));},eventListener:function(){var self=this;$(document).on('click','[data-selector="signup-form-button"]',function(){var self=$(this);if($('[data-selector="signup-form"]').valid()){self.addClass('btn-loading');IdeaApp.helpers.ajaxRequest({url:IdeaApp.routing.generate('/recaptcha-visibility'),success:function(response){if(response.success){if(response.data==='invisible'){$("#signup-form").submit();}else{if(grecaptcha.getResponse()){reCaptchaSignUpSubmit();$("#signup-form").submit();}else{IdeaApp.plugins.notification('Google Doğrulamasını işaretleyiniz.','warning');self.removeClass('btn-loading');}}}else{IdeaApp.plugins.notification(response.errorMessage,'warning');IdeaApp.plugins.loadingBar.hide();}}});}});$(document).on('focus','[name="cell"]',function(){IdeaApp.helpers.addPrefix($(this),null);});$(document).on('input','[name="cell"]',function(){IdeaApp.helpers.addPrefix($(this),null);});$(document).on('focus','[data-selector="birth-date"]',function(){IdeaApp.helpers.datePicker($(this),{language:"tr",format:"dd-mm-yyyy"});});}},login:{init:function(){this.eventListener();this.validateLoginForm();},validateLoginForm:function(){$('[data-selector="login-form"]').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',rules:{email:{required:true,email:{depends:function(){$(this).val($.trim($(this).val()));return true;}},maxlength:255},pass:{required:true,minlength:2,maxlength:255}},messages:{email:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="login-form"] input[name="email"]','placeholder')+" giriniz.",email:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="login-form"] input[name="email"]','placeholder')+" uygun formatta olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="login-form"] input[name="email"]','placeholder')+" en fazla 255 karakter olmalıdır."},pass:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="login-form"] input[name="pass"]','placeholder')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="login-form"] input[name="pass"]','placeholder')+" en az 2 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="login-form"] input[name="pass"]','placeholder')+" en fazla 255 karakter olmalıdır."}},errorPlacement:function(error,element){element.parents('.form-group').append(error);},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();}});$.validator.addMethod('email',function(email){return IdeaApp.helpers.checkEmail(email);});},eventListener:function(){$(document).on('click','[data-selector="login-form-button"]',function(){var memberLoginForm=$('[data-selector="login-form"]');if(memberLoginForm.valid()){$(this).addClass('btn-loading');}});}},b2bLogin:{init:function(){this.eventListener();this.validateLoginForm();},validateLoginForm:function(){$('[data-selector="login-form"]').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',rules:{email:{required:true,email:{depends:function(){$(this).val($.trim($(this).val()));return true;}},maxlength:255},pass:{required:true,minlength:2,maxlength:255}},messages:{email:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="login-form"] input[name="email"]','placeholder')+" giriniz.",email:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="login-form"] input[name="email"]','placeholder')+" uygun formatta olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="login-form"] input[name="email"]','placeholder')+" en fazla 255 karakter olmalıdır."},pass:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="login-form"] input[name="pass"]','placeholder')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="login-form"] input[name="pass"]','placeholder')+" en az 2 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="login-form"] input[name="pass"]','placeholder')+" en fazla 255 karakter olmalıdır."}},errorPlacement:function(error,element){element.parents('.form-group').append(error);},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();}});$.validator.addMethod('email',function(email){return IdeaApp.helpers.checkEmail(email);});},eventListener:function(){$(document).on('click','[data-selector="login-form-button"]',function(){var memberB2bLoginForm=$('[data-selector="login-form"]');if(memberB2bLoginForm.valid()){$(this).addClass('btn-loading');}});}},profile:{init:function(){this.afterInit();this.validateForm();this.eventListener();},afterInit:function(){if($('select[name="country"] option:selected').val()==1&&$('input[name="cell"]').val().indexOf("+90")===0){IdeaApp.helpers.maskPhone([$('input[name="phone"]'),$('input[name="cell"]')]);}
IdeaApp.helpers.maskDate($('input[name="birthdate"]'));},validateForm:function(){$('[data-selector="edit-profile-form"]').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',rules:{firstname:{required:true,minlength:2,maxlength:50},surname:{required:true,minlength:2,maxlength:50},email:{required:true,email:{depends:function(){$(this).val($.trim($(this).val()));return true;}},maxlength:240},birthdate:{required:($('input[name="birthdate"]').attr('data-required')==1?true:false),minlength:10,maxlength:10},'gender[]':{required:true},phone:{minlength:7,maxlength:20,phoneValid:true},cell:{required:true,minlength:7,maxlength:20,phoneValid:true},tcId:{required:($('input[name="tcId"]').attr('data-required')==1?true:false),identityRegistrationNumber:true,},taxId:{minlength:10,maxlength:11,taxNumber:true},country:{required:true},location:{required:true},address:{required:false,minlength:5,maxlength:300},cName:{required:false,minlength:1,maxlength:80},pass:{minlength:6,maxlength:16,regex:/^(?=.*[0-9])(?=.*[a-zA-Z])[a-zA-Z0-9!\.@#$%&]{6,16}$/,notEqual:true},currentPass:{required:true,}},messages:{firstname:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="firstname"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="firstname"]')+" en az 2 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="firstname"]')+" en fazla 50 karakter olmalıdır."},surname:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="surname"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="surname"]')+" en az 2 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="surname"]')+" en fazla 50 karakter olmalıdır."},email:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="email"]')+" giriniz.",email:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="email"]')+" uygun formatta olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="email"]')+" en fazla 250 karakter olmalıdır."},birthdate:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="birthdate"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="birthdate"]')+" en az 10 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="birthdate"]')+" en fazla 10 karakter olmalıdır."},'gender[]':{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="gender[]"]')+" giriniz."},phone:{minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="phone"]')+" en az 7 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="phone"]')+" en fazla 20 karakter olmalıdır.",phoneValid:"Lütfen geçerli bir "+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="phone"]')+" giriniz."},cell:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="cell"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="cell"]')+" en az 7 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="cell"]')+" en fazla 20 karakter olmalıdır.",phoneValid:"Lütfen geçerli bir "+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="cell"]')+" giriniz."},tcId:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="tcId"]')+" giriniz.",identityRegistrationNumber:"Lütfen geçerli bir "+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="tcId"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="tcId"]')+" en az 11 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="tcId"]')+" en fazla 11 karakter olmalıdır."},taxId:{taxNumber:"Lütfen geçerli bir "+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="taxId"]')+" giriniz.",},country:{required:"Lütfen Ülke seçiniz."},location:{required:"Lütfen Şehir seçiniz."},address:{minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] textarea[name="address"]')+" en az 5 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] textarea[name="address"]')+" en fazla 300 karakter olmalıdır."},cName:{minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="cName"]')+" en az 1 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="cName"]')+" en fazla 80 karakter olmalıdır."},pass:{required:"Lütfen geçerli bir "+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="pass"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="pass"]')+" en az 6 karakter olmalıdır, bir harf ve rakam içermelidir.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="pass"]')+" en fazla 16 karakter olmalıdır.",regex:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="pass"]')+" uzunluğu en az 6 hane sadece harf ve rakamdan oluşmalıdır.",notEqual:"Mevcut şifre alanı ile yeni şifre alanı aynı olamaz."},currentPass:{required:IdeaApp.helpers.getFormValidateMessage('[data-selector="edit-profile-form"] input[name="currentPass"]')+" giriniz.",}},errorPlacement:function(error,element){error=IdeaApp.helpers.modifyValidationError(error);if(element.attr("type")=="radio"){element.parents('.radio-custom-groups').after(error)}else if(element.attr("type")=="checkbox"){element.parents('.checkbox-custom-groups').after(error)}else if(element.attr("data-selector")=="birth-date"){element.parents('.input-group').after(error);}else{element.after(error)}},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();},highlight:function(element){$(element).addClass('validate-error');if(element.type!=="checkbox"&&element.type!=='radio'){return;}
$(element).parent().siblings().find('input[type="checkbox"], input[type="radio"]').addClass('validate-error');},unhighlight:function(element){$(element).removeClass('validate-error');if(element.type!=="checkbox"&&element.type!=='radio'){return;}
$(element).parent().siblings().find('input[type="checkbox"], input[type="radio"]').removeClass('validate-error');}});$.validator.addMethod('regex',function(value,element,regexp){return IdeaApp.helpers.checkRegex(value,element,regexp)});$.validator.addMethod('identityRegistrationNumber',function(value){return IdeaApp.helpers.checkIdentityNumber(value)});$.validator.addMethod('taxNumber',function(value){return IdeaApp.helpers.checkTaxNumber(value)});$.validator.addMethod('email',function(email){return IdeaApp.helpers.checkEmail(email);});$.validator.addMethod('phoneValid',function(value){return IdeaApp.helpers.checkPhone(value);});$.validator.addMethod('notEqual',function(value){return value!==$('#currentPass').val();});IdeaApp.helpers.addCustomizationFormRules($('[data-selector="edit-profile-form"]'));},changeCountry:function(element){if(element.attr('disabled')){return;}
var countryId=element.val();element.parent('.selectbox').addClass('selectbox-loading').find('select').attr('disabled',true);$('select[name="location"], input[name="location"], input[name="town"]').attr('disabled',true);IdeaApp.helpers.ajaxRequest({url:IdeaApp.routing.generate('/location/country-id/'+countryId),success:function(response){if(response.success){$('[data-selector="location-wrapper"]').html(IdeaApp.member.profile.createLocationHTML(response.data));element.parent('.selectbox').removeClass('selectbox-loading').find('select').removeAttr('disabled');$('select[name="location"], input[name="location"], input[name="town"]').removeAttr('disabled');$('input[name="town"]').prop('value',' ');}}});if(countryId==1){IdeaApp.helpers.maskPhone([$('input[name="phone"]'),$('input[name="cell"]')]);$('input[name="phone"]').attr('placeholder','(XXX) XXX XX XX');$('input[name="cell"]').attr('placeholder','(5XX) XXX XX XX');}else{IdeaApp.helpers.unMask([$('input[name="phone"]'),$('input[name="cell"]')]);$('input[name="phone"]').attr('placeholder','');$('input[name="cell"]').attr('placeholder','');}},createLocationHTML:function(data){var output='';if(data.length>0){output=' \
                            <div class="selectbox"> \
                                <select id="location" class="form-control" name="location" data-selector="change-location" autocomplete="shipping address-line2"> \
                                    <option value="">Seçiniz</option>';for(var i=0;i<data.length;i++){output+='<option value="'+data[i].id+'">'+data[i].name+'</option>';}
output+='</select>'
output+='</div>';}else{output='<input type="text" id="location" name="location" class="form-control" autocomplete="shipping address-line2"/>'}
return output;},deleteAccount:function(element){if(element.attr('disabled')){return;}
IdeaApp.plugins.confirmDialog('Hesabınızı kalıcı olarak silmek istediğinizden emin misiniz?',function(){element.addClass('btn-loading').attr('disabled',true);IdeaApp.helpers.ajaxRequest({url:IdeaApp.routing.generate('/hesabi-sil'),success:function(response){if(response.success){IdeaApp.plugins.notification(response.data,'confirmation');setTimeout(function(){window.location.href='/';},3000);}else{IdeaApp.plugins.notification(response.errorMessage,'warning');IdeaApp.plugins.loadingBar.hide();}}});});},suspendAccount:function(element){if(element.attr('disabled')){return;}
IdeaApp.plugins.confirmDialog('Hesabınızı dondurmak istediğinizden emin misiniz?',function(){element.addClass('btn-loading').attr('disabled',true);IdeaApp.helpers.ajaxRequest({url:IdeaApp.routing.generate('/hesabi-dondur'),success:function(response){if(response.success){IdeaApp.plugins.notification(response.data,'confirmation');setTimeout(function(){window.location.href='/';},3000);}else{IdeaApp.plugins.notification(response.errorMessage,'warning');IdeaApp.plugins.loadingBar.hide();}}});});},eventListener:function(){$(document).on('change','[data-selector="change-country"]',function(){IdeaApp.member.profile.changeCountry($(this));});$(document).on('change','[data-selector="change-password"]',function(){if($(this).is(':checked')){$('input[name="pass"]').rules('add',{required:true});$('input[name="currentPass"]').rules('add',{required:true});$('[data-selector="new-password-wrapper"]').removeClass('d-none');$('[data-selector="current-password-wrapper"]').removeClass('d-none');}else{$('input[name="pass"]').rules('remove','required');$('input[name="pass"]').removeClass('validate-error');$('input[name="currentPass"]').rules('remove','required');$('input[name="currentPass"]').removeClass('validate-error');$('#pass-error').remove();$('[data-selector="new-password-wrapper"]').addClass('d-none');$('[data-selector="current-password-wrapper"]').addClass('d-none');}});$(document).on('click','[data-selector="edit-profile-form-button"]',function(){var editProfileForm=$('[data-selector="edit-profile-form"]');if(editProfileForm.valid()){$(this).addClass('btn-loading');}});$(document).on('click','[data-selector="edit-profile-form-button-deleted"]',function(){IdeaApp.member.profile.deleteAccount($(this));});$(document).on('click','[data-selector="edit-profile-form-button-suspend"]',function(){IdeaApp.member.profile.suspendAccount($(this));});$(document).on('focus','[data-selector="birth-date"]',function(){IdeaApp.helpers.datePicker($(this),{language:"tr",format:"dd-mm-yyyy"});});$(document).on('focus','[name="phone"], [name="cell"]',function(){IdeaApp.helpers.addPrefix($(this),$('#country').val());});$(document).on('blur','[name="phone"]',function(){IdeaApp.helpers.removePrefix($(this));});$(document).on('input','[name="phone"], [name="cell"]',function(){IdeaApp.helpers.addPrefix($(this),$('#country').val());});}},favouriteList:{init:function(){this.eventListener();},removeFavouriteProduct:function(element){var productId=element.attr('data-product-id');IdeaApp.plugins.confirmDialog('Ürünü favorilerden kaldırmak istiyor musunuz?',function(){element.addClass('btn-loading');var options={url:IdeaApp.routing.generate('/hesabim/favori-sil'),data:{'product_id':productId,'anticsrf':anticsrf},success:function(response){if(response.success){$('.favourite-product-table tr[data-product-id="'+productId+'"]').remove();if($('.favourite-product-table tr').length<2){$('.information-content').parent().removeClass('d-none');$('.favourite-product-table').remove();}}else{IdeaApp.plugins.notification(response.errorMessage,'warning');}
element.removeClass('btn-loading');}};IdeaApp.helpers.ajaxRequest(options);});},eventListener:function(){$(document).on('click','[data-selector="remove-favourite-product"]',function(){IdeaApp.member.favouriteList.removeFavouriteProduct($(this));});}},orderList:{init:function(){this.eventListener();},showOrderDetail:function(element){if(element.attr('disabled')){return;}
element.addClass('btn-loading').attr('disabled',true);var options={url:IdeaApp.routing.generate('/hesabim/siparis-detayi'),data:{order_id:IdeaApp.member.orderList.getOrderId(element)},success:function(response){$.fancybox.open(response,{touch:false});$('[data-toggle="tooltip"]').tooltip();element.removeClass('btn-loading').removeAttr('disabled');}}
IdeaApp.helpers.ajaxRequest(options);},showBillingDetail:function(element){if(element.attr('disabled')){return;}
element.addClass('btn-loading').attr('disabled',true);var options={url:IdeaApp.routing.generate('/hesabim/teslimat-ve-fatura-bilgileri'),data:{order_id:IdeaApp.member.orderList.getOrderId(element)},success:function(response){$.fancybox.open(response,{touch:false});$('[data-toggle="tooltip"]').tooltip()
element.removeClass('btn-loading').removeAttr('disabled');}}
IdeaApp.helpers.ajaxRequest(options);},print:function(element){var url='';if(element.attr('data-type')=='shipping'){url='/hesabim/siparis-kargo-bilgisi-yazdir?orderId='+IdeaApp.member.orderList.getOrderId(element);}else if(element.attr('data-type')=='order'){url='/hesabim/siparis-yazdir?orderId='+IdeaApp.member.orderList.getOrderId(element);}
IdeaApp.helpers.print(element,IdeaApp.routing.generate(url));},remakeOrder:function(element){if(element.attr('disabled')){return;}
element.addClass('btn-loading').attr('disabled',true);var options={url:IdeaApp.routing.generate('/hesabim/siparisi-tekrarla'),data:"orderId="+IdeaApp.member.orderList.getOrderId(element),success:function(response){if(response.success){window.location=response.data.url;}else{IdeaApp.plugins.notification(response.errorMessage,'warning');}
element.removeClass('btn-loading').removeAttr('disabled');}};IdeaApp.helpers.ajaxRequest(options);},getOrderId:function(element){return element.attr('data-id');},eventListener:function(){$(document).on('click','[data-selector="show-order-detail"]',function(){IdeaApp.member.orderList.showOrderDetail($(this));});$(document).on('click','[data-selector="show-billing-detail"]',function(){IdeaApp.member.orderList.showBillingDetail($(this));});$(document).on('click','[data-selector="print-shipping"], [data-selector="print-order"]',function(){IdeaApp.member.orderList.print($(this));});$(document).on('click','[data-selector="refund-and-cancel"]',function(){$(this).addClass('btn-loading').attr('disabled',true);});$(document).on('click','[data-selector="remake-order"]',function(){IdeaApp.member.orderList.remakeOrder($(this));});}},bankTransfer:{init:function(){this.validateForm();this.eventListener();},validateForm:function(){$('[data-selector="bank-transfer-form"]').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',rules:{refno:{required:true},payment_gateway_id:{required:true},info:{required:false,minlength:5,maxlength:150}},messages:{refno:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="bank-transfer-form"] select[name="refno"]')+" seçiniz.",},payment_gateway_id:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="bank-transfer-form"] select[name="payment_gateway_id"]')+" seçiniz.",},info:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="bank-transfer-form"] textarea[name="info"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="bank-transfer-form"] textarea[name="info"]')+" en az 5 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="bank-transfer-form"] textarea[name="info"]')+" en fazla 150 karakter olmalıdır."}},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();}});},eventListener:function(){$(document).on('click','[data-selector="bank-transfer-form-button"]',function(){var self=$(this);var bankTransferForm=$('[data-selector="bank-transfer-form"]');if(bankTransferForm.valid()){self.addClass('btn-loading');IdeaApp.helpers.ajaxRequest({url:IdeaApp.routing.generate('/recaptcha-visibility'),success:function(response){if(response.success){if(response.data==='invisible'){$("#bank-transfer-form").submit();}else{if(grecaptcha.getResponse()){reCaptchaBankTransferSubmit();$("#bank-transfer-form").submit();}else{IdeaApp.plugins.notification('Google Doğrulamasını işaretleyiniz.','warning');self.removeClass('btn-loading');}}}else{IdeaApp.plugins.notification(response.errorMessage,'warning');IdeaApp.plugins.loadingBar.hide();}}});}});}},forgotpass:{init:function(){this.validateForm();this.eventListener();},validateForm:function(){$('[data-selector="forgot-password-form"]').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',rules:{email:{required:true,email:{depends:function(){$(this).val($.trim($(this).val()));return true;}},},},messages:{email:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="forgot-password-form"] input[name="email"]')+" giriniz.",email:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="forgot-password-form"] input[name="email"]')+" uygun formatta olmalıdır."},},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();}});$.validator.addMethod('email',function(email){return IdeaApp.helpers.checkEmail(email);});},eventListener:function(){$(document).on('click','[data-selector="forgot-password-form-button"]',function(){var self=$(this);var forgotPasswordForm=$('[data-selector="forgot-password-form"]');if(forgotPasswordForm.valid()){self.addClass('btn-loading');IdeaApp.helpers.ajaxRequest({url:IdeaApp.routing.generate('/recaptcha-visibility'),success:function(response){if(response.success){if(response.data==='invisible'){$("#forgot-password-form").submit();}else{if(grecaptcha.getResponse()){forgotPassSubmit();$("#forgot-password-form").submit();}else{IdeaApp.plugins.notification('Google Doğrulamasını işaretleyiniz.','warning');self.removeClass('btn-loading');}}}else{IdeaApp.plugins.notification(response.errorMessage,'warning');IdeaApp.plugins.loadingBar.hide();}}});}});}},renewPassword:{init:function(){this.validateForm();this.eventListener();},validateForm:function(){$('[data-selector="renew-password-form"]').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',rules:{password:{required:true,minlength:6,maxlength:16,regex:/^(?=.*[0-9])(?=.*[a-zA-Z])[a-zA-Z0-9!\.@#$%&]{6,16}$/,alphanumeric:true},repassword:{required:true,alphanumeric:true,minlength:6,maxlength:16,regex:/^(?=.*[0-9])(?=.*[a-zA-Z])[a-zA-Z0-9!\.@#$%&]{6,16}$/,equalTo:'input[name=password]'}},messages:{password:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="renew-password-form"] input[name="password"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="renew-password-form"] input[name="password"]')+" en az 6 karakter olmalıdır, bir harf ve rakam içermelidir.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="renew-password-form"] input[name="password"]')+" en fazla 16 karakter olmalıdır.",regex:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="renew-password-form"] input[name="password"]')+" uzunluğu en az 6 hane sadece harf ve rakamdan oluşmalıdır.",alphanumeric:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="renew-password-form"] input[name="password"]')+" yalnızca harf ve rakamlardan oluşmalıdır."},repassword:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="renew-password-form"] input[name="repassword"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="renew-password-form"] input[name="repassword"]')+" en az 6 karakter olmalıdır, bir harf ve rakam içermelidir.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="renew-password-form"] input[name="repassword"]')+" en fazla 16 karakter olmalıdır.",regex:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="renew-password-form"] input[name="repassword"]')+" uzunluğu en az 6 hane sadece harf ve rakamdan oluşmalıdır.",equalTo:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="renew-password-form"] input[name="repassword"]')+" ve "+IdeaApp.helpers.getFormValidateMessage('[data-selector="renew-password-form"] input[name="repassword"]')+" alanları aynı olmalıdır.",alphanumeric:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="renew-password-form"] input[name="repassword"]')+" yalnızca harf ve rakamlardan oluşmalıdır."}},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();}});$.validator.addMethod('regex',function(value,element,regexp){return IdeaApp.helpers.checkRegex(value,element,regexp)});},eventListener:function(){$(document).on('click','[data-selector="renew-password-form-button"]',function(){var forgotPasswordForm=$('[data-selector="renew-password-form"]');if(forgotPasswordForm.valid()){$(this).addClass('btn-loading');}});}},orderRefund:{init:function(){this.afterInit();this.eventListener();},afterInit:function(){$('[name^=refunded_amount_]').each(function(index,element){if($(element).val()>=$(element).attr('[data-amount]')){$(this).parents('tr').find('.refund-list-checkbox').find('.checkbox-custom').remove();}});},productQuantityDown:function(element){var quantity=Number(element.parents('.quantity').find('input').val());if(quantity>0){quantity=quantity-Number(1);element.parent('.quantity').find('input').attr('value',quantity);}else{IdeaApp.plugins.notification('Bu ürünün iade değeri negatif olamaz.','warning');}},productQuantityUp:function(element){var quantity=Number(element.parents('.quantity').find('input').val()),stockAmount=Number(element.attr('data-stock-amount'))-Number(element.parents('.quantity').find('input').attr('data-refunded'));if(stockAmount>quantity){quantity=quantity+1;element.parent('.quantity').find('input').attr('value',quantity);}else{IdeaApp.plugins.notification('Bu üründen en fazla '+stockAmount+' tane iade edebilirsiniz.','warning');}},checkAmountControl:function(element){var leftAmount=Number(element.attr('data-amount'))-Number(element.attr('data-refunded'));if(element.val()>leftAmount){element.val(leftAmount);}},selectedAllRefund:function(element){if(element.is(':checked')){$('input[name="refund-select[]"]').prop('checked',true);}else{$('input[name="refund-select[]"]').prop('checked',false)}},checkRefundForm:function(element){if(element.attr('disabled')){return;}
if($('input[name="refund-select[]"]:checked').length==0){IdeaApp.plugins.notification('İade veya Geri Gönderim talebi oluşturabilmek için en az 1 sipariş kalemi seçmelisiniz.','warning');return;}
var allAmountsAreSet=true;var allReasonsAreSelected=true;$('input[name="refund-select[]"]:checked').each(function(i,element){if($('input[name="refunded_amount_'+$(element).val()+'"]').val()==0){allAmountsAreSet=false;return false;}
if($('select[name="reason_'+$(element).val()+'"] option:selected').val()==0){allReasonsAreSelected=false;return false;}});if(!allAmountsAreSet){IdeaApp.plugins.notification('İade veya İptal etmek istediğiniz ürünlerin her birisi için iade edilecek miktarı seçilmelidir.','warning');return;}
if(!allReasonsAreSelected){IdeaApp.plugins.notification('İade veya İptal etmek istediğiniz ürünlerin her birisi için iade veya iptal sebebi seçilmelidir.','warning');return;}
if(!$('input[name="accept_refund_conditions"]').is(':checked')){IdeaApp.plugins.notification('İade ve Geri Gönderim Şartlarını kabul etmeniz gerekmektedir.','warning');return;}
element.addClass('btn-loading');setTimeout(function(){IdeaApp.member.orderRefund.resultRefundForm(element);},1500);},resultRefundForm:function(element){element.removeClass('btn-loading');var output=' \
                        <div class="contentbox-footer">'
$('input[name="refund-select[]"]:checked').each(function(i,element){var orderItemId=$(element).val();if(i>0){output+='<hr>'}
output+=' \
                    <input type="hidden" name="refunded_items[]" value="'+orderItemId+'"> \
                    <div class="form-group row"> \
                        <label class="col-12 col-md-3 control-label">Ürün</label> \
                        <div class="col-12 col-md-6"><input type="text" class="form-control" value="'+$(element).parents('tr').find('.refund-list-product-name').find('span:first-child').html()+'" disabled></div> \
                    </div> \
                    <div class="form-group row"> \
                        <label class="col-12 col-md-3 control-label">İade Edilmesi İstenen Miktar</label> \
                        <div class="col-12 col-md-6"><input type="text" class="form-control" value="'+$('input[name="refunded_amount_'+orderItemId+'"]').val()+'" disabled></div> \
                    </div> \
                    <div class="form-group row"> \
                        <label class="col-12 col-md-3 control-label">Sebep</label> \
                        <div class="col-12 col-md-6"><input type="text" class="form-control" value="'+$('select[name="reason_'+orderItemId+'"] option:selected').val()+'" disabled></div> \
                    </div> \
                    <div class="form-group row"> \
                        <label class="col-12 col-md-3 control-label">Açıklama</label> \
                        <div class="col-12 col-md-6"> \
                            <textarea class="form-control" name="details_'+orderItemId+'" placeholder="Açıklama giriniz"></textarea> \
                        </div> \
                    </div>';});output+=' \
                    <hr> \
                    <div class="form-group row mb-0 justify-content-end"> \
                        <div class="col-auto"> \
                                <a href="javascript:void(0);" class="btn btn-secondary" data-selector="cancel-refund-form-button">Vazgeç</a> \
                        </div> \
                        <div class="col-auto"> \
                            <button type="submit" class="btn btn-primary" data-selector="submit-refund-form-button">İptal ve İade Talebi Oluştur</button> \
                        </div> \
                    </div> \
                </div>';element.parents('form').append(output);element.attr('disabled',true);},submitRefundForm:function(event){var checkTextarea=false;$('[name^=details_]').each(function(i,element){if($(element).val().length<2){checkTextarea=true;}});if(checkTextarea){IdeaApp.plugins.notification('İade veya iptal talebi oluşturabilmek için lütfen açıklama alanlarını doldurunuz.','warning');event.preventDefault();return;}
$('[data-selector="submit-refund-form-button"]').addClass('btn-loading').prop('disabled',true);},cancelRefundForm:function(element){element.parents('.contentbox-footer').remove();$('input[name="accept_refund_conditions"], input[name="refund-select[]"]').prop('checked',false);$('[data-selector="check-refund-form-button"]').removeAttr('disabled');$('[name^=refunded_amount_]:not([data-change="false"])').attr('value',0);$('[name^=reason_12] option[value="0"]').prop('selected',true);},eventListener:function(){$(document).on('click','[data-selector="quantity-down"]',function(){IdeaApp.member.orderRefund.productQuantityDown($(this));});$(document).on('click','[data-selector="quantity-up"]',function(){IdeaApp.member.orderRefund.productQuantityUp($(this));});$(document).on('change','[data-selector="refund-select-all"]',function(){IdeaApp.member.orderRefund.selectedAllRefund($(this));});$(document).on('submit','[data-selector="refund-form"]',function(event){IdeaApp.member.orderRefund.submitRefundForm(event);});$(document).on('click','[data-selector="cancel-refund-form-button"]',function(){IdeaApp.member.orderRefund.cancelRefundForm($(this));});$(document).on('click','[data-selector="check-refund-form-button"]',function(){IdeaApp.member.orderRefund.checkRefundForm($(this));});$(document).on('keydown','[data-selector="quantity-input"]',function(event){IdeaApp.helpers.controlDecimalOnly(event);});$(document).on('blur','[data-selector="quantity-input"]',function(){IdeaApp.member.orderRefund.checkAmountControl($(this));});}},orderRefundList:{init:function(){this.eventListener();},showRefundDetail:function(element){if(element.attr('disabled')){return;}
var id=element.attr('data-id');element.addClass('btn-loading').attr('disabled',true);var options={type:'GET',url:IdeaApp.routing.generate('/hesabim/iade-ve-iptal-detayi?requestId='+id),success:function(response){$.fancybox.open(response,{touch:false});element.removeClass('btn-loading').removeAttr('disabled');}}
IdeaApp.helpers.ajaxRequest(options);},eventListener:function(){$(document).on('click','[data-selector="show-refund-detail-button"]',function(){IdeaApp.member.orderRefundList.showRefundDetail($(this));});}},invitationList:{init:function(){},},invite:{init:function(){this.eventListener();this.validateInviteForm();},validateInviteForm:function(){$('[data-selector="invite-form"]').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',rules:{invitationReceipts:{required:true,maxlength:500},invitationMessage:{required:true,minlength:2,maxlength:1000}},messages:{invitationReceipts:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="invite-form"] textarea[name="invitationReceipts"]')+" giriniz.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="invite-form"] textarea[name="invitationReceipts"]')+" en fazla 255 karakter olmalıdır."},invitationMessage:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="invite-form"] textarea[name="invitationMessage"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="invite-form"] textarea[name="invitationMessage"]')+" en az 2 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="invite-form"] textarea[name="invitationMessage"]')+" en fazla 1000 karakter olmalıdır."}},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();}});$.validator.addMethod('email',function(email){return IdeaApp.helpers.checkEmail(email);});},checkInvitationMessageLength:function(element){var strLength=element.val().length;if(1000-strLength<0){return;}
$('.invitation-message-count').val(1000-strLength);},eventListener:function(){$(document).on('click','[data-selector="invite-form-button"]',function(){var inviteForm=$('[data-selector="invite-form"]');if(inviteForm.valid()){$(this).addClass('btn-loading');}});$(document).on('keyup','textarea[name="invitationMessage"]',function(){IdeaApp.member.invite.checkInvitationMessageLength($(this));});}},paymentDirection:{init:function(){this.afterInit();this.validateForm();this.eventListener();},afterInit:function(){IdeaApp.helpers.maskPhone([$('input[name="phone"]'),$('input[name="cardOwnerPhone"]')]);IdeaApp.helpers.maskDate($('input[name="orderDate"]'));},validateForm:function(){$('[data-selector="payment-direction-form"]').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',rules:{cName:{required:true,maxlength:80},email:{required:true,email:{depends:function(){$(this).val($.trim($(this).val()));return true;}},maxlength:60},phone:{phoneValid:true,minlength:7,maxlength:20},address:{minlength:5,maxlength:300},bCode:{required:true,maxlength:60},cardOwnerFullname:{required:true,maxlength:50},cardOwnerAddress:{minlength:5,maxlength:300},cardOwnerPhone:{required:true},ccno1:{required:true,minlength:4,maxlength:4},ccno2:{required:true,minlength:4,maxlength:4},ccno3:{required:true,minlength:4,maxlength:4},ccno4:{required:true,minlength:3,maxlength:4},ccmonth:{required:true},ccyear:{required:true},cctype:{required:true},price:{required:true,maxlength:50},inst:{required:true,maxlength:50}},messages:{cName:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] input[name="cName"]')+" giriniz.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] input[name="cName"]')+" en fazla 80 karakter olmalıdır."},email:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] input[name="email"]')+" giriniz.",email:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] input[name="email"]')+" uygun formatta olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] input[name="email"]')+" en fazla 60 karakter olmalıdır."},phone:{phoneValid:"Lütfen geçerli bir "+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] input[name="phone"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] input[name="phone"]')+" en az 7 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] input[name="phone"]')+" en fazla 20 karakter olmalıdır."},address:{minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] textarea[name="address"]')+" en az 5 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] textarea[name="address"]')+" en fazla 300 karakter olmalıdır."},bCode:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] input[name="bCode"]')+" giriniz.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] input[name="bCode"]')+" en fazla 50 karakter olmalıdır."},cardOwnerFullname:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] input[name="cardOwnerFullname"]')+" giriniz.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] input[name="cardOwnerFullname"]')+" en fazla 50 karakter olmalıdır."},cardOwnerPhone:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] input[name="cardOwnerPhone"]')+" giriniz."},cardOwnerAddress:{minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] textarea[name="cartOwnerAddress"]')+" en az 5 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] textarea[name="cartOwnerAddress"]')+" en fazla 300 karakter olmalıdır."},ccno1:{required:"",minlength:"",maxlength:""},ccno2:{required:"",minlength:"",maxlength:""},ccno3:{required:"",minlength:"",maxlength:""},ccno4:{required:"",minlength:"",maxlength:""},ccmonth:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] select[name="ccmonth"]')+" seçiniz."},ccyear:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] select[name="ccyear"]')+" seçiniz."},cctype:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] select[name="cctype"]')+" seçiniz."},price:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] input[name="price"]')+" giriniz.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] input[name="price"]')+" en fazla 50 karakter olmalıdır."},inst:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] input[name="inst"]')+" giriniz.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="payment-direction-form"] input[name="inst"]')+" en fazla 50 karakter olmalıdır."}},errorPlacement:function(error,element){if(element.attr("type")=="radio"){element.parents('.radio-custom-groups').after(error)}else if(element.attr("type")=="checkbox"){element.parents('.checkbox-custom-groups').after(error)}else{element.after(error)}},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();}});$.validator.addMethod('phoneValid',function(value){return IdeaApp.helpers.checkPhone(value);});$.validator.addMethod('email',function(email){return IdeaApp.helpers.checkEmail(email);});},creditCardPass:function(element,number){var valuelength=element.val().length;var index=element.parent().index();if(valuelength==number&&index!=4){element.parent().next().find('input').select();}},submitForm:function(){var editProfileForm=$('[data-selector="payment-direction-form"]');if(editProfileForm.valid()){$(this).addClass('btn-loading');}},eventListener:function(){$(document).on('click','[data-selector="payment-submit-button"]',function(){IdeaApp.member.paymentDirection.submitForm();});$(document).on('focus','[data-selector="order-date"]',function(){IdeaApp.helpers.datePicker($(this),{language:"tr",format:"dd-mm-yyyy"});});$(document).on('keydown','[data-selector="credit-card-number"]',function(){IdeaApp.helpers.controlFloatOnly(event);});$(document).on('keydown','[data-selector="order-price"]',function(){IdeaApp.helpers.controlDecimalOnly(event);});$(document).on('keydown','[data-selector="payment-installment"]',function(){IdeaApp.helpers.controlFloatOnly(event);});$(document).on('keyup','[data-selector="credit-card-number"]',function(){IdeaApp.member.paymentDirection.creditCardPass($(this),4);});}},paymentList:{init:function(){this.eventListener();},viewPayment:function(element){if(element.attr('disabled')){return;}
element.addClass('btn-loading').attr('disabled',true);var options={url:IdeaApp.routing.generate('/hesabim/odeme-detayi'),data:{id:element.attr('data-id')},success:function(response){$.fancybox.open(response,{touch:false});element.removeClass('btn-loading').removeAttr('disabled');}};IdeaApp.helpers.ajaxRequest(options);},printPaymentReceipt:function(element){var url='/hesabim/odeme-dekontu-yazdir?paymentId='+element.attr('data-id');IdeaApp.helpers.print(element,IdeaApp.routing.generate(url));},eventListener:function(){$(document).on('click','[data-selector="view-payment"]',function(){IdeaApp.member.paymentList.viewPayment($(this));});$(document).on('click','[data-selector="print-payment-receipt"]',function(){IdeaApp.member.paymentList.printPaymentReceipt($(this));});}},pointList:{init:function(){this.eventListener();},checkPoint:function(element){var points=$('input[name="pointsToUse"]').val();var minToken=element.attr('data-min-token');if(parseInt(points)<parseInt(minToken)){IdeaApp.plugins.notification('Hediye Çeki oluşturmak için yeterli miktarda puan yazınız.','warning');}else{element.addClass('btn-loading').attr('disabled');$('[data-selector="token-production-form"]').submit();}},eventListener:function(){$(document).on('keypress','[data-selector="token-production-form"]',function(event){if(event.keyCode===13){event.preventDefault();return;}});$(document).on('click','[data-selector="token-production-form-button"]',function(event){IdeaApp.member.pointList.checkPoint($(this));});}},contractList:{init:function(){this.eventListener();},cancelSubscription:function(element){var id=element.attr('data-id');IdeaApp.plugins.confirmDialog('Aboneliğiniz kalıcı olarak iptal edilecektir işleme devam etmek istediğinizden emin misiniz?',function(){element.addClass('btn-loading').attr('disabled');window.location=IdeaApp.routing.generate("/hesabim/abonelik-iptal?contractId="+id);});},eventListener:function(){$(document).on('click','[data-selector="cancel-subscription"]',function(){IdeaApp.member.contractList.cancelSubscription($(this));});}},contractPlanList:{init:function(){}},addressList:{init:function(){this.afterInit();this.eventListener();},afterInit:function(){IdeaApp.helpers.maskPhone([$('input[name="phone"]'),$('input[name="cell"]')]);},validateAddressForm:function(){$('[data-selector="add-address-form"], [data-selector="edit-address-form"]').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',rules:{address_name:{required:true,maxlength:100},type:{required:true},firstname:{required:true,minlength:2,maxlength:60},surname:{required:true,minlength:2,maxlength:60},country:{required:true},location:{required:true,maxlength:60},town:{required:true,maxlength:30},phone:{phoneValid:true,minlength:7,maxlength:20},zipCode:{required:true,zipCodeValid:true},cell:{required:true,phoneValid:true,minlength:7,maxlength:20},tc_id:{required:($('input[name="tc_id"]').attr('data-required')==1?true:false),identityRegistrationNumber:true},address:{required:true,minlength:5,maxlength:300},tax_id:{required:true,taxNumber:true},tax_place:{required:true}},messages:{address_name:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="address_name"], [data-selector="edit-address-form"] input[name="address_name"]')+" giriniz.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="address_name"], [data-selector="edit-address-form"] input[name="address_name"]')+" en fazla 100 karakter olmalıdır."},type:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="type"], [data-selector="edit-address-form"] input[name="type"]')+" giriniz."},firstname:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="firstname"], [data-selector="edit-address-form"] input[name="firstname"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="firstname"], [data-selector="edit-address-form"] input[name="firstname"]')+" en az 2 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="firstname"], [data-selector="edit-address-form"] input[name="firstname"]')+" en fazla 60 karakter olmalıdır."},surname:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="surname"], [data-selector="edit-address-form"] input[name="surname"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="surname"], [data-selector="edit-address-form"] input[name="surname"]')+" en az 2 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="surname"], [data-selector="edit-address-form"] input[name="surname"]')+" en fazla 60 karakter olmalıdır."},country:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] select[name="country"], [data-selector="edit-address-form"] select[name="country"]')+" seçinm."},location:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] select[name="location"], [data-selector="add-address-form"] input[name="location"], [data-selector="edit-address-form"] select[name="location"], [data-selector="edit-address-form"] input[name="location"]')+" giriniz.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] select[name="location"], [data-selector="add-address-form"] input[name="location"], [data-selector="edit-address-form"] select[name="location"], [data-selector="edit-address-form"] input[name="location"]')+" en fazla 60 karakter olmalıdır."},town:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] select[name="town"], [data-selector="add-address-form"] input[name="town"], [data-selector="edit-address-form"] select[name="town"], [data-selector="edit-address-form"] input[name="town"]')+" giriniz.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] select[name="town"], [data-selector="add-address-form"] input[name="town"], [data-selector="edit-address-form"] select[name="town"], [data-selector="edit-address-form"] input[name="town"]')+" en fazla 30 karakter olmalıdır."},zipCode:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="zipCode"], [data-selector="edit-address-form"] input[name="zipCode"]')+" giriniz.",zipCodeValid:"Lütfen geçerli bir "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="zipCode"], [data-selector="edit-address-form"] input[name="zipCode"]')+" giriniz.",},phone:{phoneValid:"Geçerli bir "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="phone"], [data-selector="edit-address-form"] input[name="phone"]')+" giriniz.",minlength:"Geçerli bir "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="phone"], [data-selector="edit-address-form"] input[name="phone"]')+" giriniz.",maxlength:"Geçerli bir "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="phone"], [data-selector="edit-address-form"] input[name="phone"]')+" giriniz."},cell:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="cell"], [data-selector="edit-address-form"] input[name="cell"]')+" giriniz.",phoneValid:"Geçerli bir "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="cell"], [data-selector="edit-address-form"] input[name="cell"]')+" giriniz.",minlength:"Geçerli bir "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="cell"], [data-selector="edit-address-form"] input[name="cell"]')+" giriniz.",maxlength:"Geçerli bir "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="cell"], [data-selector="edit-address-form"] input[name="cell"]')+" giriniz."},tc_id:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="tc_id"], [data-selector="edit-address-form"] input[name="tc_id"]')+" giriniz.",identityRegistrationNumber:"Geçerli bir "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="tc_id"], [data-selector="edit-address-form"] input[name="tc_id"]')+" giriniz"},address:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] textarea[name="address"], [data-selector="edit-address-form"] textarea[name="address"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] textarea[name="address"], [data-selector="edit-address-form"] textarea[name="address"]')+" en az 5 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] textarea[name="address"], [data-selector="edit-address-form"] textarea[name="address"]')+" en fazla 300 karakter olmalıdır."},tax_id:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="tax_id"], [data-selector="edit-address-form"] input[name="tax_id"]')+" giriniz.",taxNumber:"Geçerli bir "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="tax_id"], [data-selector="edit-address-form"] input[name="tax_id"]')+" giriniz"},tax_place:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-address-form"] input[name="tax_place"], [data-selector="edit-address-form"] input[name="tax_place"]')+" giriniz."}},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();}});$('[data-required="0"]').each(function(){$(this).rules("remove","required");});$.validator.addMethod('phoneValid',function(value){return IdeaApp.helpers.checkPhone(value);});$.validator.addMethod('identityRegistrationNumber',function(value){return IdeaApp.helpers.checkIdentityNumber(value)});$.validator.addMethod('taxNumber',function(value){return IdeaApp.helpers.checkTaxNumber(value)});$.validator.addMethod('zipCodeValid',function(value,element){var countryCode=$('[data-selector="change-country"]').val();return IdeaApp.helpers.checkZipCode(value,element,countryCode);});},viewAddAddress:function(element){if(element.attr('disabled')){return;}
element.addClass('btn-loading').attr('disabled',true);IdeaApp.helpers.ajaxRequest({url:IdeaApp.routing.generate('/hesabim/adres-ekleme-formu'),success:function(response){$.fancybox.open(response,{touch:false});IdeaApp.member.addressList.validateAddressForm();element.removeClass('btn-loading').removeAttr('disabled');if($('select[name="country"] option:selected').val()==1||$('select[name="country"] option:selected').val()==""){IdeaApp.helpers.maskPhone([$('input[name="phone"]'),$('input[name="cell"]')]);}}});},viewEditAddress:function(element){if(element.attr('disabled')){return;}
var addressId=element.parents('.address-list-box').attr('data-address-id');element.addClass('btn-loading').attr('disabled',true);IdeaApp.helpers.ajaxRequest({url:IdeaApp.routing.generate('/hesabim/adres-duzenleme-formu'),data:{address_id:addressId},success:function(response){$.fancybox.open(response,{touch:false});element.removeClass('btn-loading').removeAttr('disabled');IdeaApp.member.addressList.validateAddressForm();if($('select[name="country"] option:selected').val()==1){IdeaApp.helpers.maskPhone([$('input[name="phone"]'),$('input[name="cell"]')]);}}});},submitAddressForm:function(element){if(element.attr('disabled')||!$('[data-selector="add-address-form"], [data-selector="edit-address-form"]').valid()){return;}
var type=element.attr('data-type');var formArray,url='';if(type=='add'){formArray=$('[data-selector="add-address-form"]').serializeArray();url='/hesabim/adres-ekle';}else{formArray=$('[data-selector="edit-address-form"]').serializeArray();url='/hesabim/adres-duzenle';}
element.addClass('btn-loading').attr('disabled',true);var options={url:IdeaApp.routing.generate(url),data:formArray,success:function(response){if(response.success){location.reload();}else{IdeaApp.plugins.notification(response.errorMessage,'warning');element.removeClass('btn-loading').removeAttr('disabled');}}};IdeaApp.helpers.ajaxRequest(options);},changeCountry:function(element){if(element.attr('disabled')){return;}
var countryId=element.val();if(countryId!=''){element.parent('.selectbox').addClass('selectbox-loading').find('select').attr('disabled',true);$('select[name="location"], input[name="location"], select[name="town"], input[name="town"]').attr('disabled',true);IdeaApp.helpers.ajaxRequest({url:IdeaApp.routing.generate('/location/country-id/'+countryId),success:function(response){if(response.success){$('[data-selector="location-wrapper"]').html(IdeaApp.member.addressList.createLocationHTML(response.data));if(countryId!='1'&&countryId!='170'){$('[data-selector="town-wrapper"]').html('\
                                            <input type="text" id="town" name="town" class="form-control" /> \
                                        ');}
element.parent('.selectbox').removeClass('selectbox-loading').find('select').removeAttr('disabled');$('select[name="location"], input[name="location"]').removeAttr('disabled');}}});if(countryId==1){IdeaApp.helpers.maskPhone([$('input[name="phone"]'),$('input[name="cell"]')]);$('input[name="phone"]').attr('placeholder','(XXX) XXX XX XX');$('input[name="cell"]').attr('placeholder','(5XX) XXX XX XX');}else{IdeaApp.helpers.unMask([$('input[name="phone"]'),$('input[name="cell"]')]);$('input[name="phone"]').attr('placeholder','');$('input[name="cell"]').attr('placeholder','');}}else{$('[data-selector="location-wrapper"]').html('\
                            <div class="selectbox"> \
                                <select id="location" class="form-control" name="location" data-selector="change-location" disabled> \
                                    <option value="">Seçiniz</option> \
                                </select> \
                            </div> \
                        ');$('[data-selector="town-wrapper"]').html('\
                            <div class="selectbox"> \
                                <select id="town" class="form-control" name="town" disabled> \
                                    <option value="">Seçiniz</option> \
                                </select> \
                            </div> \
                        ');IdeaApp.helpers.maskPhone([$('input[name="phone"]'),$('input[name="cell"]')]);$('input[name="phone"]').attr('placeholder','(XXX) XXX XX XX');$('input[name="cell"]').attr('placeholder','(5XX) XXX XX XX');}},createLocationHTML:function(data){var output='';if(data.length>0){output=' \
                            <div class="selectbox"> \
                                <select id="location" class="form-control" name="location" data-selector="change-location" autocomplete="shipping address-line2"> \
                                    <option value="">Seçiniz</option>';for(var i=0;i<data.length;i++){output+='<option value="'+data[i].id+'">'+data[i].name+'</option>';}
output+='</select>'
output+='</div>';}else{output='<input type="text" id="location" name="location" class="form-control" autocomplete="shipping address-line2"/>'}
return output;},changeLocation:function(element){if(element.attr('disabled')){return;}
var locationId=element.val();if(locationId!=''){$('select[name="town"]').attr('disabled',true);element.parent('.selectbox').addClass('selectbox-loading').find('select').attr('disabled',true);var options={url:IdeaApp.routing.generate('/town/location-id/'+locationId),success:function(response){if(response.success){$('[data-selector="town-wrapper"]').html(IdeaApp.member.addressList.createTownHTML(response.data));$('select[name="town"]').removeAttr('disabled');element.parent('.selectbox').removeClass('selectbox-loading').find('select').removeAttr('disabled');}}}
IdeaApp.helpers.ajaxRequest(options);}else if(locationId==''){$('[data-selector="town-wrapper"]').html('\
                            <div class="selectbox"> \
                                <select id="town" class="form-control" name="town" disabled> \
                                    <option value="">Seçiniz</option> \
                                </select> \
                            </div> \
                        ');}},createTownHTML:function(data){var output='';if(data.length>0){output=' \
                            <div class="selectbox"> \
                                <select id="town" class="form-control" name="town" autocomplete="shipping address-line2"> \
                                    <option value="">Seçiniz</option>';for(var i=0;i<data.length;i++){output+='<option value="'+data[i].name+'">'+data[i].name+'</option>';}
output+='</select>'
output+='</div>';}else{output='<input type="text" id="town" name="town" class="form-control" autocomplete="shipping address-line2"/>'}
return output;},changeBillingType:function(element){if(element.val()=='individual'){$('input[name="tc_id"]').prop('disabled',false);$('input[name="tc_id"]').parents('.form-group-binary').find('.required').removeClass('d-none');$('[data-selector="billing-form-detail"]').addClass('d-none');$('input[name="tax_id"], input[name="tax_place"], input[name="is_einvoice_user"]').prop('disabled',true);}else{$('input[name="tc_id"] + .validate-error').remove();$('input[name="tc_id"]').parents('.form-group-binary').find('.required').addClass('d-none');$('[data-selector="billing-form-detail"]').removeClass('d-none');$('input[name="tc_id"]').prop('disabled',true).removeClass('validate-error');$('input[name="tax_id"], input[name="tax_place"], input[name="is_einvoice_user"]').prop('disabled',false);}},changeAddressType:function(element){if(element.val()=='billing'){$('[data-selector="billing-type-wrapper"]').removeClass('d-none');$('input[name="invoice_type"]').prop('disabled',false);if(!$('input[name="invoice_type"]:checked[value="individual"]')){$('input[name="tc_id"] + .validate-error').remove();$('input[name="tc_id"]').prop('disabled',true).removeClass('validate-error');}}else{$('input[name="invoice_type"][value="individual"]').prop('checked',true);$('input[name="invoice_type"][value="corporate"]').prop('checked',false);$('input[name="tc_id"], input[name="invoice_type"]').prop('disabled',false);$('[data-selector="billing-type-wrapper"], [data-selector="billing-form-detail"]').addClass('d-none');}},deleteAddress:function(element){if(element.attr('disabled')){return;}
IdeaApp.plugins.confirmDialog('Seçili adresi silmek istediğinizden emin misiniz?',function(){var addressId=element.parents('.address-list-box').attr('data-address-id');element.addClass('btn-loading').attr('disabled',true);var options={url:IdeaApp.routing.generate('/hesabim/adres-sil'),data:{'anticsrf':anticsrf,'address_id':addressId},success:function(response){if(response.success){$('.address-list-box[data-address-id="'+addressId+'"]').remove();}else{IdeaApp.plugins.notification(response.errorMessage,'warning');}
element.removeClass('btn-loading').removeAttr('disabled');}}
IdeaApp.helpers.ajaxRequest(options);});},eventListener:function(){$(document).on('submit','[data-selector="add-address-form"], [data-selector="edit-address-form"]',function(event){event.preventDefault();});$(document).on('click','[data-selector="add-address-button"]',function(){IdeaApp.member.addressList.viewAddAddress($(this));});$(document).on('click','[data-selector="edit-address-button"]',function(){IdeaApp.member.addressList.viewEditAddress($(this));});$(document).on('click','[data-selector="add-address-form-button"], [data-selector="edit-address-form-button"]',function(){IdeaApp.member.addressList.submitAddressForm($(this));});$(document).on('change','[data-selector="change-country"]',function(){IdeaApp.member.addressList.changeCountry($(this));});$(document).on('focus','[name="cell"], [name="phone"]',function(){IdeaApp.helpers.addPrefix($(this),$('#country').val());});$(document).on('blur','[name="phone"]',function(){IdeaApp.helpers.removePrefix($(this));});$(document).on('input','[name="cell"], [name="phone"]',function(){IdeaApp.helpers.addPrefix($(this),$('#country').val());});$(document).on('change','[data-selector="change-location"]',function(){IdeaApp.member.addressList.changeLocation($(this));});$(document).on('change','[data-selector="change-billing-type"]',function(){IdeaApp.member.addressList.changeBillingType($(this));});$(document).on('change','[data-selector="change-address-type"]',function(){IdeaApp.member.addressList.changeAddressType($(this));});$(document).on('click','[data-selector="delete-address-button"]',function(){IdeaApp.member.addressList.deleteAddress($(this));});}},ticketList:{init:function(){this.eventListener();},closeTicket:function(element){IdeaApp.plugins.confirmDialog('Destek talebini kapatmak istediğinizden emin misiniz?',function(){window.location.href=IdeaApp.routing.generate("/hesabim/destek-talebi-kapat/"+element.attr('data-ticket-id'));});},eventListener:function(){$(document).on('click','[data-selector="close-ticket"]',function(){IdeaApp.member.ticketList.closeTicket($(this));});}},ticketAdd:{init:function(){this.eventListener();this.validateAddTicketForm();},validateAddTicketForm:function(){$('[data-selector="add-ticket-form"]').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',rules:{subject:{required:true},content:{required:true,minlength:10,maxlength:400},},messages:{subject:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-ticket-form"] input[name="subject"]')+" giriniz.",},content:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-ticket-form"] textarea[name="content"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-ticket-form"] textarea[name="content"]')+" en fazla 10 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-ticket-form"] textarea[name="content"]')+" en fazla 400 karakter olmalıdır."}},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();}});},eventListener:function(){$(document).on('click','[data-selector="add-ticket-form-button"]',function(){var self=$(this)
var addTicketForm=$('[data-selector="add-ticket-form"]');if(addTicketForm.valid()){self.addClass('btn-loading');IdeaApp.helpers.ajaxRequest({url:IdeaApp.routing.generate('/recaptcha-visibility'),success:function(response){if(response.success){if(response.data==='invisible'){$("#add-ticket-form").submit();}else{if(grecaptcha.getResponse()){reCaptchaTicketSubmit();$("#add-ticket-form").submit();}else{IdeaApp.plugins.notification('Google Doğrulamasını işaretleyiniz.','warning');self.removeClass('btn-loading');}}}else{IdeaApp.plugins.notification(response.errorMessage,'warning');IdeaApp.plugins.loadingBar.hide();}}});}});}},ticketDetail:{init:function(){this.eventListener();this.validateAddTicketForm();},validateAddTicketForm:function(){$('[data-selector="add-ticket-form"]').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',rules:{subject:{required:true},content:{required:true,minlength:10,maxlength:400},},messages:{subject:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-ticket-form"] input[name="subject"]')+" giriniz.",},content:{required:"Lütfen "+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-ticket-form"] textarea[name="content"]')+" giriniz.",minlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-ticket-form"] textarea[name="content"]')+" en fazla 10 karakter olmalıdır.",maxlength:""+IdeaApp.helpers.getFormValidateMessage('[data-selector="add-ticket-form"] textarea[name="content"]')+" en fazla 400 karakter olmalıdır."},},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();}});},eventListener:function(){$(document).on('click','[data-selector="add-ticket-form-button"]',function(){var self=$(this)
var addTicketForm=$('[data-selector="add-ticket-form"]');if(addTicketForm.valid()){self.addClass('btn-loading');IdeaApp.helpers.ajaxRequest({url:IdeaApp.routing.generate('/recaptcha-visibility'),success:function(response){if(response.success){if(response.data==='invisible'){$("#addReplyForm").submit();}else{if(grecaptcha.getResponse()){reCaptchaTicketDetailSubmit();$("#addReplyForm").submit();}else{IdeaApp.plugins.notification('Google Doğrulamasını işaretleyiniz.','warning');self.removeClass('btn-loading');}}}else{IdeaApp.plugins.notification(response.errorMessage,'warning');IdeaApp.plugins.loadingBar.hide();}}});}});}},paymentIndex:{binCache:'',paymentGateway:null,binSettings:null,masterpassStatus:false,mainPaymentGateway:null,init:function(){this.eventListener();this.validateForm();this.checkAndLoadSearchParams();this.iyzico.init();this.ozan.init();},iyzico:{init:function(){this.eventListener();},createOrder:function(callback){IdeaApp.helpers.ajaxRequest({url:'/order/iyzico/create',data:{'anticsrf':anticsrf},success:function(){if(callback&&typeof callback=='function'){callback();}}});},isReadyToSubmit:function(){return $('#iyzicoReadyToSubmit').val();},checkSession:function(){$.ajax({url:'/order/iyzico/check',type:'POST',dataType:'json',async:false,data:{'anticsrf':$("input[name*='anticsrf']").val()},success:function(data,status,jqXhr){$('#iyzicoReadyToSubmit').val(1);},error:function(xhr,status){IdeaApp.plugins.notification(xhr.responseJSON.errorMessage,'warning');$('#iyzicoReadyToSubmit').val(0);}})},loadForm:function(){var self=this;var activeForm=$("#idea-pay-form");if(activeForm.valid()&&IdeaApp.member.paymentIndex.agreementValid()){$('[data-selector="iyzico-submit-button"]').addClass('btn-loading').attr('disabled',true);IdeaApp.helpers.ajaxRequest({url:"/order/iyzico/prepare-form",data:{'customPaymentNote':$('textarea[name="customPaymentNote"]').val(),'anticsrf':anticsrf,'amount':parseFloat($('#amount').val()),'currency':$('#currency').val(),'show_button':1},beforeSend:function(){IdeaApp.plugins.loadingBar.show();},success:function(response){$('[data-selector="change-amount"]').removeClass('d-none');$('[data-selector="iyzico-submit-button"]').remove();$('#new-add-custom-payment, textarea[name="customPaymentNote"], #amount, #currency, #agreement').attr('disabled',true);$('#iyzipay-checkout-form').html(response).addClass('margin-bottom-20');$('#iyzipay-checkout-form').append("<input type='hidden' id='iyzicoReadyToSubmit' value='0'>");self.createOrder(function(){self.checkSession()});IdeaApp.plugins.loadingBar.hide();},error:function(){IdeaApp.plugins.notification('Kredi kartı formu yüklenemedi. Lütfen daha sonra tekrar deneyiniz.','warning');$('[data-selector="iyzico-submit-button"]').removeClass('btn-loading').removeAttr('disabled');$('#new-add-custom-payment, textarea[name="customPaymentNote"], #amount, #currency, #agreement').attr('disabled',true);IdeaApp.plugins.loadingBar.hide();}});}},eventListener:function(){var self=this;$(document).on('click','[data-selector="iyzico-submit-button"]',function(){self.loadForm();});}},ozan:{init:function(){this.eventListener();},createOrder:function(){IdeaApp.helpers.ajaxRequest({url:'/order/ozan/create',data:{'anticsrf':anticsrf},success:function(){var submitButton=$('[data-selector="submit-button"]');submitButton.removeAttr('disabled').removeClass('btn-loading');}});},checkOzan:function(){$.ajax({url:'/order/ozan/check',type:'POST',dataType:'json',async:false,data:{'anticsrf':$("input[name*='anticsrf']").val()},success:function(data,status,jqXhr){},error:function(xhr,status){IdeaApp.plugins.notification(xhr.responseJSON.errorMessage,'warning');}})},loadForm:function(){var self=this;var activeForm=$("#idea-pay-form");if(activeForm.valid()&&IdeaApp.member.paymentIndex.agreementValid()){$('[data-selector="ozan-submit-button"]').addClass('btn-loading').attr('disabled',true);IdeaApp.helpers.ajaxRequest({url:"/order/ozan/prepare-form",data:{'customPaymentNote':$('textarea[name="customPaymentNote"]').val(),'anticsrf':anticsrf,'amount':parseFloat($('#amount').val()),'currency':$('#currency').val()},beforeSend:function(){IdeaApp.plugins.loadingBar.show();},success:function(response){$('[data-selector="change-amount"]').removeClass('d-none');$('[data-selector="ozan-submit-button"]').remove();$('#new-add-custom-payment, textarea[name="customPaymentNote"], #amount, #currency, #agreement').attr('disabled',true);var iframeWin=$('#iFrameOzan');iframeWin.parent().show()
document.getElementById('iFrameOzan').src=response;self.createOrder();window.addEventListener("message",function messageReader(message){if((message.source!==message.target)){if(message.data.event==="RESIZE_FRAME"){iframeWin.height(message.data.data.height);}
if(message.data.event==="FORM_SUBMITTED"){self.checkOzan();iframeWin.css({"position":"fixed","width":"80%","height":"90%","top":"50%","left":"50%","transform":"translate(-50%, -50%)","z-index":"9999","box-shadow":"0 0 1000px 1000px rgba(0,0,0,0.5)","background-color":"#fff"});}}},false)
IdeaApp.plugins.loadingBar.hide();},error:function(){IdeaApp.plugins.notification('Kredi kartı formu yüklenemedi. Lütfen daha sonra tekrar deneyiniz.','warning');$('[data-selector="iyzico-submit-button"]').removeClass('btn-loading').removeAttr('disabled');$('#new-add-custom-payment, textarea[name="customPaymentNote"], #amount, #currency, #agreement').attr('disabled',true);IdeaApp.plugins.loadingBar.hide();}});}},eventListener:function(){var self=this;$(document).on('click','[data-selector="ozan-submit-button"]',function(){self.loadForm();});}},masterpass:{hasRegisteredCard:false,initialize:false,init:function(){if(!this.initialize){this.eventListener();this.check();this.initialize=true;this.requestError();}},requestError:function(){window.onerror=function(msg,url,line,col,error){if(msg!='Script error.'){return;}
IdeaApp.plugins.loadingBar.hide();$('#masterpass-save-card-form, #masterpass-card-list').addClass('d-none');$('#credit-card-form').removeClass('d-none');IdeaApp.member.paymentIndex.masterpassStatus=false;};},checkSelectedCard:function(){if(!IdeaApp.member.paymentIndex.masterpassStatus){return;}
var selectedCard=$('input[name="masterpass-card"]:checked');if(selectedCard.length<1){return;}else if(selectedCard.val()==0){return;}
this.selectedCard(selectedCard);},check:function(){var self=this;IdeaApp.plugins.loadingBar.show();MFS.checkMasterPass($("#masterpass-check-form"),function(status,response){if(response.responseCode=='0000'||response.responseCode==''){if(response.accountStatus.substr(1,4)=='1110'){MFS.listCards($("#masterpass-check-form").find('input[name="userId"]').val(),masterpassToken,function(status,response){if(response.cards){self.listCard(response.cards);}else{self.hasRegisteredCard=false;$('#masterpass-save-card-form').addClass('d-none');}
IdeaApp.plugins.loadingBar.hide();});}else if(response.accountStatus.substr(1,4)=='1100'){self.showLinkCardToClientTemplate();IdeaApp.plugins.loadingBar.hide();}else if(response.accountStatus.substr(1,4)=='0000'){$('#credit-card-form, #masterpass-save-card-form').removeClass('d-none');$('#masterpass-card-list').remove();self.hasRegisteredCard=false;IdeaApp.plugins.loadingBar.hide();}}else{IdeaApp.plugins.loadingBar.hide();$('#credit-card-form').removeClass('d-none');$('#masterpass-save-card-form').addClass('d-none');$('#masterpass-card-list').remove();self.hasRegisteredCard=false;IdeaApp.member.paymentIndex.masterpassStatus=false;}});},loadToken:function(tokenParams){var token=null;$('[data-selector="payment-submit-button"]').addClass('btn-loading').attr('disabled',true);IdeaApp.helpers.ajaxRequest({url:IdeaApp.routing.generate('/masterpass/create_token'),async:false,data:tokenParams,success:function(response){if(response.success){token=response.data.token;}else{$('[data-selector="payment-submit-button"]').removeClass('btn-loading').removeAttr('disabled');IdeaApp.plugins.notification(response.errorMessage,'warning');}}});return token;},registerAndPurchase:function(){var self=this;var token=self.loadToken({gateway_id:IdeaApp.member.paymentIndex.paymentGateway.gateway_id,use_three_d:$('#use3d').is(':checked'),card_type:IdeaApp.member.paymentIndex.binSettings.cardType,anticsrf:anticsrf});if(token===null){return;}
var registerAndPurchaseForm=$('#masterpass-register-and-purchase-form');registerAndPurchaseForm.find('input[name="installmentCount"]').val(parseInt($('input[name="inst"]:checked').val()));registerAndPurchaseForm.find('input[name="token"]').val(token);registerAndPurchaseForm.find('input[name="accountAliasName"]').val($('input[name="masterpass-card-name"]').val());registerAndPurchaseForm.find('input[name="rtaPan"]').val($('input[name="ccnumber"]').val().replace(/\s/g,''));registerAndPurchaseForm.find('input[name="expiryDate"]').val($('select[name="ccyear"]').val()+$('select[name="ccmonth"]').val());registerAndPurchaseForm.find('input[name="cvc"]').val($('input[name="cvc2"]').val());registerAndPurchaseForm.find('input[name="cardHolderName"]').val($('input[name="ccname"]').val());registerAndPurchaseForm.find('input[name="amount"]').val(IdeaApp.member.paymentIndex.masterpass.getCurrentFinalAmount());MFS.purchaseAndRegister(registerAndPurchaseForm,function(status,response){if(response.responseCode=="5001"){self.showPopup($('#masterpass-otp-form'),'timer2');$('#masterpass-otp-form').removeClass('d-none');}else if(response.responseCode=="5008"){self.showPopup($('#masterpass-mpin-form'),'timer');$('#masterpass-mpin-form').removeClass('d-none');}else if(response.responseCode=="5010"){$('input[name="masterpass_threed_url"]').val(response.url3D);$('[data-selector="payment-submit-button"]').addClass('btn-loading').attr('disabled','disabled');$('#idea-pay-form').attr("action","/order/masterpass").submit();}else{IdeaApp.plugins.notification('Masterpass : '+response.responseDescription,'warning');$('[data-selector="payment-submit-button"]').removeClass('btn-loading').removeAttr('disabled');}});},purchase:function(){var self=this;var token=self.loadToken({gateway_id:IdeaApp.member.paymentIndex.paymentGateway.gateway_id,use_three_d:$('.masterpass-card-list-row.active input[name="useMasterpass3d"]').is(':checked'),is_otp_active:false,card_type:IdeaApp.member.paymentIndex.binSettings.cardType,anticsrf:anticsrf});if(token===null){return;}
var purchaseForm=$('#masterpass-purchase-form');purchaseForm.find('input[name="amount"]').val(self.getCurrentFinalAmount());purchaseForm.find('input[name="listAccountName"]').val($('[data-selector="masterpass-card-select"]:checked').attr('data-cardname'));purchaseForm.find('input[name="cvc"]').val($('[data-selector="masterpass-card-select"]:checked').parents('.masterpass-card-list-row').find('input[name="masterpassCvc"]').val());purchaseForm.find('input[name="installmentCount"]').val(parseInt($('input[name="inst"]:checked').val()));purchaseForm.find('input[name="token"]').val(token);MFS.purchase(purchaseForm,function(status,response){if(response.responseCode==''){$('input[name="masterpass_last_token"]').val(response.token);$('[data-selector="payment-submit-button"]').addClass('btn-loading').attr('disabled','disabled');$('#idea-pay-form').attr("action","/order/masterpass").submit();}else if(response.responseCode=='5001'){self.showPopup($('#masterpass-otp-form'),'timer2');$('#masterpass-otp-form').removeClass('d-none');}else if(response.responseCode=='5010'){$('input[name="masterpass_threed_url"]').val(response.url3D);$('[data-selector="payment-submit-button"]').addClass('btn-loading').attr('disabled','disabled');$('#idea-pay-form').attr("action","/order/masterpass").submit();}else{IdeaApp.plugins.notification('Masterpass : '+response.responseDescription,'warning');$('[data-selector="payment-submit-button"]').removeClass('btn-loading').removeAttr('disabled');}});},linkCardToClient:function(){var self=this;var token=self.loadToken({use_three_d:false,is_otp_active:false,is_mpin_active:false,anticsrf:anticsrf});if(token===null){return;}
$('.masterpass-modal .btn-primary').addClass('btn-loading');var linkCardToClientForm=$('#masterpass-linkcard-to-client-form');linkCardToClientForm.find('input[name="token"]').val(token);MFS.linkCardToClient($("#masterpass-linkcard-to-client-form"),function(status,response){$.fancybox.close();if(response.responseCode=="0000"||response.responseCode==""){IdeaApp.plugins.notification("Masterpass'e kayıtlı kredi kartlarınızı artık bu sitede kullanabilirsiniz.",'confirmation');}else{if(response.responseCode=="5001"||response.responseCode=="5008"){self.showPopup($('#masterpass-otp-form'),'timer2');$('#otp-form .btn-primary').attr('data-type','link-card-to-client');$('#masterpass-otp-form').removeClass('d-none');}else{IdeaApp.plugins.notification('Masterpass: '+response.responseDescription,'warning');}}
$('.masterpass-modal .btn-primary').removeClass('btn-loading');});},listCard:function(response){var self=this;self.hasRegisteredCard=true;$('#masterpass-card-list').remove();$('#credit-card-form, #masterpass-save-card-form').addClass('d-none');$('#credit-card-form').before('<div class="form-group" id="masterpass-card-list">'+self.listCardTemplate(response)+'</div>');$('[data-toggle="tooltip"]').tooltip();},selectedCard:function(element){var self=this;self.hasRegisteredCard=true;$('#credit-card-form, #masterpass-save-card-form').addClass('d-none');IdeaApp.plugins.loadingBar.show();var binNumber=element.attr('data-binnumber').split('*')[0];$.ajax({type:"POST",url:IdeaApp.routing.generate("/idea-pay/settings"),data:{'bin_number':binNumber,'amount':$('#amount').val(),'currency':$('#currency').val(),'anticsrf':anticsrf},success:function(response){if(response.success){var paymentGateway=response.data.payment_gateway;var binSettings=response.data.bin_settings;IdeaApp.member.mainPaymentGateway=response.data.main_payment_gateway;IdeaApp.member.paymentIndex.paymentGateway=paymentGateway;IdeaApp.member.paymentIndex.binSettings=binSettings;var posAccountId=IdeaApp.member.paymentIndex.getCurrentCreditCardGateway().pos_account_id;$('input[name="posid"]').val(posAccountId);$('#credit-card-container').removeClass('d-none');IdeaApp.member.paymentIndex.changeCreditCardForm(paymentGateway);IdeaApp.member.paymentIndex.showCreditCardInstallmentOptions(binSettings,paymentGateway);}else{IdeaApp.member.paymentIndex.changeInstallmentEmptyMessage('Siparişiniz için bu banka üzerinde ödeme seçeneği mevcut değildir. Lütfen farklı bir banka seçiniz.');IdeaApp.member.paymentIndex.hideCreditCardFormElements();}
IdeaApp.plugins.loadingBar.hide();},error:function(){IdeaApp.member.paymentIndex.changeInstallmentEmptyMessage('Siparişiniz için bu banka üzerinde ödeme seçeneği mevcut değildir. Lütfen farklı bir banka seçiniz.');IdeaApp.member.paymentIndex.hideCreditCardFormElements();IdeaApp.plugins.loadingBar.hide();}});},selectedOtherCard:function(element){var self=this;self.hasRegisteredCard=false;$('#credit-card-form, #masterpass-save-card-form').removeClass('d-none');$('[data-selector="masterpass-card-select"]').parents('.masterpass-card-list-row').removeClass('active');element.parents('.masterpass-card-list-row').addClass('active');IdeaApp.member.paymentIndex.hideCreditCardFormElements();},deleteCard:function(element){var self=this;$('#masterpass-delete-card-form input[name="accountAliasName"]').val($(element).attr('data-card-name'));$(element).addClass('btn-loading').attr('disabled','disabled');MFS.deleteCard($('#masterpass-delete-card-form'),function(status,response){if(response.responseCode=="0000"||response.responseCode==""){IdeaApp.plugins.notification('Kart Silme Başarılı','confirmation');$.fancybox.close();$('#masterpass-card-list').remove();setTimeout(function(){$('#masterpass-delete').remove();},1000);self.check();}else{IdeaApp.plugins.notification(response.responseDescription,'warning');}
$('.masterpass-modal .btn-primary').removeAttr('disabled').removeAttr('disabled');});},showCardDeletePopup:function(element){var self=this;var cardName=element.attr('data-card-name');$('body').append(self.deleteCardTemplate(cardName));$.fancybox.open({src:'#masterpass-delete',closeBtn:false,helpers:{overlay:{closeClick:false}}});},cancelCardDeletePopup:function(){$.fancybox.close();setTimeout(function(){$('#masterpass-delete').remove();},1000);},cancelLinkToCardClient:function(){$.fancybox.close();$('#masterpass-save-card-form').remove();},deleteCardTemplate:function(cardName){var output='';output+=' \
                    <div id="masterpass-delete" class="masterpass-modal pb-2 pt-3"> \
                        <div class="masterpass-modal-header text-center"> \
                            <span class="text-center">Masterpass</span> \
                        </div> \
                        <div class="masterpass-modal-content"> \
                            <div class="form-group row"> \
                                <div class="col-12 p-3 text-center"> \
                                    Masterpass hesabına bağlı <strong>'+cardName+' </strong> adlı kartınızı silmek istediğinizden emin misiniz? \
                                </div> \
                                <div class="col-12 text-center"> \
                                    <div class="btn-group-binary">\
                                        <a href="javascript:void(0);" class="btn btn-secondary btn-sm mr-2" onclick="IdeaApp.member.paymentIndex.masterpass.cancelCardDeletePopup();" >VAZGEÇ</a> \
                                        <a href="javascript:void(0);" class="btn btn-danger btn-sm btn-icon-right" onclick="IdeaApp.member.paymentIndex.masterpass.deleteCard($(this));" data-card-name="'+cardName+'">SİL</a> \
                                    </div>\
                                </div> \
                            </div> \
                        </div> \
                    </div>'
return output;},listCardTemplate:function(response){var output='';output+=' \
                    <div class="masterpass-card-list-title mb-2">Masterpass\'e Kayıtlı Kartlarım</div> \
                    <div class="masterpass-card-list-content">';for(var i=0;i<response.length;i++){var card=response[i];output+='\
                            <div class="radio-custom-groups col-12 masterpass-card-list-row"> \
                                <div class="radio-custom masterpass-card-list-label"> \
                                    <input type="radio" id="masterpass-card-'+i+'" value="'+card.BankIca+'" data-cardname="'+card.Name+'" data-binnumber="'+card.Value1+'" name="masterpass-card" data-selector="masterpass-card-select"/> \
                                    <label class="control-label" for="masterpass-card-'+i+'" > \
                                        <span class="masterpass-card-image">\
                                            <img src="'+masterpassBankLogoList[card.BankIca]+'">\
                                        </span>\
                                        <span class="masterpass-card-text"> \
                                            <span class="masterpass-card-name">'+card.Name+'</span> \
                                            <span class="masterpass-card-value">'+card.Value1+'</span> \
                                        </span> \
                                        <span class="masterpass-card-cvc"> \
                                            <span>Güvenlik ( CVC ) kodu :</span> \
                                            <input type="text" value="" name="masterpassCvc" class="form-control" maxlength="4" autocomplete="off"/> \
                                            <div class="form-question" data-toggle="tooltip" data-placement="bottom" title="CVC Kodu Nedir? Kartınızın arka yüzündeki numaranın son 3 rakamı."> \
                                                <i class="fas fa-info-circle"></i> \
                                            </div> \
                                        </span> \
                                        <a href="javascript:void(0);" class="masterpass-card-delete" data-card-name="'+card.Name+'" onclick="IdeaApp.member.paymentIndex.masterpass.showCardDeletePopup($(this));"><i class="fas fa-times-circle"></i></a> \
                                    </label> \
                                </div> \
                        </div> ';}
output+=' \
                        <div class="col-12"> \
                            <div class="masterpass-card-list-row"> \
                                <div class="radio-custom masterpass-card-list-another"> \
                                    <input type="radio" id="masterpass-card" value="0" name="masterpass-card" data-selector="masterpass-card-select"/> \
                                    <label for="masterpass-card">Başka bir kredi kartı ile ödemek istiyorum.</label> \
                                </div> \
                            </div> \
                        </div>\
                    </div>';return output;},showLinkCardToClientTemplate:function(){var output=' \
                        <div id="masterpass-link-card-to-client-template" class="masterpass-modal"> \
                            <div class="masterpass-modal-header text-center"> \
                                <span class="text-center pb-2">Masterpass</span> \
                            </div> \
                            <div class="masterpass-modal-content"> \
                                <div class="form-group row"> \
                                    <div class="col-12 p-3 text-center"> \
                                        Masterpass\'e kayıtlı kartlarınız bulunmaktadır. Kayıtlı kartlarınızı kullanmak için "Tamam" butonuna tıklayınız. \
                                    </div> \
                                    <div class="col-12 text-center"> \
                                        <div class="btn-group-binary">\
                                            <a href="javascript:void(0);" class="btn btn-secondary btn-sm" onclick="IdeaApp.member.paymentIndex.masterpass.cancelLinkToCardClient();" >VAZGEÇ</a> \
                                            <a href="javascript:void(0);" class="btn btn-primary btn-sm" onclick="IdeaApp.member.paymentIndex.masterpass.linkCardToClient($(this));">TAMAM</a> \
                                        </div> \
                                    </div> \
                                </div> \
                            </div> \
                            <div class="masterpass-modal-footer"> \
                                <div class="masterpass-footer-logo"></div> \
                            </div> \
                        </div>';$('body').append(output);$.fancybox.open({src:'#masterpass-link-card-to-client-template',closeBtn:false,helpers:{overlay:{closeClick:false}}});},getCurrentFinalAmount:function(){var amount;if(IdeaApp.member.paymentIndex.paymentGateway.provider_type=='PayU'){var installment=parseInt($('input[name="inst"]:checked').val());if(installment<=1){amount=$('[data-selector="installment-hall"] input[type="radio"]:checked').attr('data-converted-paid-price');}else{amount=parseFloat($('[name="amount"]').val()).toFixed(2);}}else{amount=$('[data-selector="installment-hall"] input[type="radio"]:checked').attr('data-converted-paid-price');}
return amount.replace(/\./g,'').replace(/\,/g,'');},checkProviderType:function(){var inValidProviderTypeList=['Ziraat','Paynet','Denizbank','TurkPara','KuveytTurk','Segment','TurkiyeFinans','IsBank','Hepsipay','Odeabank'];if(IdeaApp.member.paymentIndex.masterpassStatus){if($.inArray(IdeaApp.member.paymentIndex.paymentGateway.provider_type,inValidProviderTypeList)!==-1){$('#masterpass-save-card-form').addClass('d-none');}else{$('#masterpass-save-card-form').removeClass('d-none');}}},showPopup:function(element,counterElement){var self=this;$.fancybox.open(element,{closeBtn:false,afterLoad:function(){$('[data-selector="payment-submit-button"]').removeClass('btn-loading');$('.masterpass-modal-content .btn-primary').removeClass('btn-loading').removeAttr('disabled');self.countDown(counterElement,function(){$('.masterpass-modal-content .btn-secondary').removeClass('d-none');$('.masterpass-modal-content .btn-primary').addClass('d-none');$('.masterpass-modal-content input[name="validationCode"]').attr('disabled',true).removeClass('validate-error');$('.masterpass-modal-content input[name="validationCode"] + label.validate-error').remove();});},helpers:{overlay:{closeClick:false}}});},resendOtpForm:function(element){var self=this;var token=MFS.getLastToken();var lang="tur";element.addClass('btn-loading').attr('disabled','disabled');MFS.resendOtp(token,lang,function(){element.removeClass('btn-loading').removeAttr('disabled');$('.masterpass-modal-content .btn-secondary').addClass('d-none');$('.masterpass-modal-content .btn-primary').removeClass('d-none');$('.masterpass-modal-content input[name="validationCode"]').removeAttr('disabled');self.countDown('timer2',function(){$('.masterpass-modal-content .btn-secondary').removeClass('d-none');$('.masterpass-modal-content .btn-primary').addClass('d-none');$('.masterpass-modal-content input[name="validationCode"]').attr('disabled',true).removeClass('validate-error');$('.masterpass-modal-content input[name="validationCode"] + label').remove();});});return false;},validateMpinForm:function(element,parentSelector){var self=this;if(!self.otpFormInputValidate(parentSelector)){return;}
$('.masterpass-modal-content .btn-primary').addClass('btn-loading').attr('disabled','disabled');MFS.validateTransaction($("#mpin-form"),function(status,response){if(status==200){if(response.responseCode=='5001'){$.fancybox.close();self.showPopup($('#masterpass-otp-form'),'timer2');$('#masterpass-otp-form').removeClass('d-none');}else if(response.responseCode=="5010"){$('input[name="masterpass_threed_url"]').val(response.url3D);$('#idea-pay-form').attr("action","/order/masterpass").submit();}else{IdeaApp.plugins.notification(response.responseDescription,'warning');$('.masterpass-modal .btn-primary').removeClass('btn-loading').removeAttr('disabled');}}});},validateOtpForm:function(element,parentSelector){var self=this;if(!self.otpFormInputValidate(parentSelector)){return;}
element.addClass('btn-loading').attr('disabled','disabled');var validateType=element.attr('data-type');MFS.validateTransaction($("#otp-form"),function(status,response){if(status==200){if(response.responseCode==''){if(validateType=='link-card-to-client'){$.fancybox.close();$('[data-selector="payment-submit-button"]').removeAttr('disabled');IdeaApp.plugins.notification("Masterpass'e kayıtlı kredi kartlarınızı artık bu sitede kullanabilirsiniz.",'confirmation');self.check();}else{$('input[name="masterpass_last_token"]').val(response.token);$('#idea-pay-form').attr("action","/order/masterpass").submit();$('[data-selector="payment-submit-button"]').attr('disabled','disabled');}}else if(response.responseCode=="5010"){$('input[name="masterpass_threed_url"]').val(response.url3D);$('#idea-pay-form').attr("action","/order/masterpass").submit();}else{IdeaApp.plugins.notification(response.responseDescription,'warning');$('.masterpass-modal .btn-primary').removeClass('btn-loading').removeAttr('disabled');}}});},otpFormInputValidate:function(parentSelector){if($(parentSelector).find('input[name="validationCode"]').val().length<1){$(parentSelector).find('input[name="validationCode"]  + label.validate-error').remove();$(parentSelector).find('input[name="validationCode"]').addClass('validate-error');return false;}else{$('input[name="validationCode"]').removeClass('validate-error');$('input[name="validationCode"] + label.validate-error').remove();return true;}},validationMasterpassForm:function(){var self=this;if(!self.hasRegisteredCard){if(IdeaApp.member.paymentIndex.paymentGateway.gateway_id==null){IdeaApp.plugins.notification('Siparişiniz için bu banka üzerinde ödeme seçeneği mevcut değildir. Lütfen farklı bir banka seçiniz.','warning');}else{if(IdeaApp.member.paymentIndex.paymentGateway.provider_type=='PayU'){$('[data-selector="payment-submit-button"]').addClass('btn-loading').attr('disabled',true);IdeaApp.helpers.ajaxRequest({url:IdeaApp.routing.generate('/masterpass/create_additional_parameters'),data:{'final_amount':self.getCurrentFinalAmount(),'anticsrf':anticsrf},success:function(response){MFS.setAdditionalParameters(response.data.additional_data);self.registerAndPurchase();}});}else{self.registerAndPurchase();}}}else{if($('input[name="masterpass-card"]:checked').length<1){$('.masterpass-card-list-row.active input[name="masterpassCvc"]').addClass('validate-error').focus();IdeaApp.plugins.notification('Lütfen kayıtlı kartlarınız dan birini seçiniz.','warning');return;}else if(!IdeaApp.member.paymentIndex.agreementValid()){return;}else if($('[data-selector="masterpass-card-select"]:checked').parents('.masterpass-card-list-row').find('input[name="masterpassCvc"]').val().length<3){$('.masterpass-card-list-row.active input[name="masterpassCvc"]').addClass('validate-error').focus();IdeaApp.plugins.notification('Lütfen güvenlik ( CVC ) kodunu giriniz.','warning');return;}
if(IdeaApp.member.paymentIndex.paymentGateway.provider_type=='PayU'){$('[data-selector="payment-submit-button"]').addClass('btn-loading').attr('disabled',true);IdeaApp.helpers.ajaxRequest({url:IdeaApp.routing.generate('/masterpass/create_additional_parameters'),data:{'final_amount':self.getCurrentFinalAmount(),'anticsrf':anticsrf},success:function(response){MFS.setAdditionalParameters(response.data.additional_data);self.purchase();}});}else{self.purchase();}}},countDown:function(element,callback){if($(".fancybox-inner").find('#timer').length==1){element='timer';}
if($(".fancybox-inner").find('#timer2').length==1){element='timer2';}
document.getElementById(element).innerHTML='03'+":"+'00';startTimer();function startTimer(){var presentTime=document.getElementById(element).innerHTML;var timeArray=presentTime.split(/[:]+/);var m=timeArray[0];var s=checkSecond((timeArray[1]-1));if(s==59){m=m-1}
if(m<0){if(callback&&typeof callback=='function'){callback();}
clearInterval(startTimer);}else{document.getElementById(element).innerHTML=m+":"+s;setTimeout(startTimer,1000);}}
function checkSecond(sec){if(sec<10&&sec>=0){sec="0"+sec}
if(sec<0){sec="59"}
return sec;}},eventListener:function(){var self=this;$('input[name="validationCode"]').keyup(function(){if($(this).val().length>1){$('.masterpass-modal-content input[name="validationCode"]').removeClass('validate-error').next('label').remove();}else{$('.masterpass-modal-content input[name="validationCode"] + label.validate-error').remove();$('.masterpass-modal-content input[name="validationCode"]').addClass('validate-error');}});$(document).on('change','[data-selector="masterpass-card-select"]',function(){if($(this).val()=='0'){self.selectedOtherCard($(this));}else{self.selectedCard($(this));}});$(document).on('keyup','.masterpass-card-list-row.active input[name="masterpassCvc"]',function(){if($(this).val().length<3){$('.masterpass-card-list-row.active input[name="masterpassCvc"]').addClass('validate-error');}else{$('input[name="masterpassCvc"]').removeClass('validate-error');}});$(document).on('submit','#masterpass-mpin-form form, #masterpass-otp-form form',function(e){e.preventDefault();if(e&&e.keyCode==13){e.preventDefault();}});$(document).on('click','[data-action="validate-mpin-form"]',function(){self.validateMpinForm($(this),'#masterpass-mpin-form');});$(document).on('click','[data-action="validate-otp-form"]',function(){self.validateOtpForm($(this),'#masterpass-otp-form');});$(document).on('click','[data-action="resend-otp-form"]',function(){self.resendOtpForm($(this));});}},validateForm:function(){$('#idea-pay-form').validate({errorElement:"div",validClass:'validate',errorClass:'validate-error',focusInvalid:false,rules:{ccname:{required:true,creditCardName:true},ccnumber:{required:true,creditCardNumber:true},cvc2:{required:true,minlength:3},ccmonth:{required:true},ccyear:{required:true},cctype:{required:true},"masterpass-card-name":{masterpassCardName:true}},messages:{ccname:{required:"Lütfen kart üzerindeki isim alanını giriniz.",creditCardName:"Lütfen kart üzerindeki isim alanını kontrol ediniz."},ccnumber:{required:"Lütfen kredi kartı numarası giriniz.",creditCardNumber:"Lütfen geçerli kart numarası giriniz."},cvc2:{required:"CVC giriniz.",minlength:"CVC giriniz."},ccmonth:{required:"Ay seçiniz."},ccyear:{required:"Yıl seçiniz."},cctype:{required:"Kart tipini seçiniz."},"masterpass-card-name":{masterpassCardName:"Lütfen geçerli kart ismi giriniz."}},invalidHandler:function(form,validator){if(!validator.numberOfInvalids()){return;}
$('html, body').animate({scrollTop:$(validator.errorList[0].element).top-10},200);},showErrors:function(errorMap,errorList){for(var i=0;i<errorList.length;i++){var error=errorList[i];error=IdeaApp.helpers.modifyValidationError(error);}
this.defaultShowErrors();}});$.validator.addMethod('creditCardNumber',function(value){return IdeaApp.helpers.checkCreditCardNumber(value);});$.validator.addMethod('creditCardName',function(value){return IdeaApp.helpers.checkCreditCardName(value);});$.validator.addMethod('masterpassCardName',function(value){if($('input[name="masterpass-save"]').is(':checked')&&value.length<3){return false;}
return true;});},checkAndLoadSearchParams:function(){var amount=IdeaApp.helpers.getSearchParameterByName('tutar');if(amount!==null){amount=parseFloat(amount);if(amount<0){amount=0;}
var amountElement=$('[name="amount"]');amountElement.val(amount);this.changeAmount(amountElement);}
var currency=IdeaApp.helpers.getSearchParameterByName('kur');if(currency!==null){var currencyElement=$('[name="currency"]');var currentCurrency=currencyElement.val();var optionElement=$('[name="currency"] option');var selectedCurrency=optionElement.removeAttr('selected').filter('[value="'+currency.toUpperCase()+'"]');if(selectedCurrency.length>0){selectedCurrency.attr('selected',true);}else{optionElement.removeAttr('selected').filter('[value="'+currentCurrency+'"]').attr('selected',true);}}
var customerNote=IdeaApp.helpers.getSearchParameterByName('not');if(customerNote!==null){$('#add-payment-note').trigger('click');$('textarea[name="customPaymentNote"]').text(customerNote);}},changeAmount:function(element){var self=this;var amount=element.val();if(parseFloat(amount)<=0){return;}
if(amount.indexOf(",")>-1){element.val(amount.replace(",",""));}
if($.isNumeric(amount)){$('#credit-card-container, #agreement-content').removeClass('d-none');}else{$('#credit-card-container, #agreement-content').addClass('d-none')}
if($('#iyzipay-checkout-form').length==0&&element.attr('data-masterpass')=='true'){self.masterpassStatus=true;self.masterpass.init();}
self.hideCreditCardFormElements();self.masterpass.checkSelectedCard();$('[name="ccnumber"]').val('');$('.card-number').html('');},changeCurrency:function(){this.hideCreditCardFormElements();this.masterpass.checkSelectedCard();$('input[name="ccnumber"]').val('');$('.card-number').html('');},changeInstallment:function(){var currentPaymentGateway=this.getCurrentCreditCardGateway();$('input[name="posid"]').val(currentPaymentGateway.pos_account_id);this.changeCreditCardForm(currentPaymentGateway)},changeCreditCardNumber:function(element){var self=this;var cartNumber=element.val().replace(/\s+/g,"");var binNumber=cartNumber.toString().substring(0,8);$('.card-number').html(element.val());if(binNumber.length<8){self.binCache='';self.hideCreditCardFormElements();}else if(binNumber.length==8&&binNumber!=self.binCache){self.loadCreditCardSettings(binNumber);}},hideCreditCardFormElements:function(){$('[data-selector="installment-empty"]').removeClass('d-none');$('[data-selector="installment-hall"]').addClass('d-none');$('.card-logo > img, .card-type-logo > img').addClass('d-none');$('.card-logo > i').removeClass('d-none');$('[data-selector="optional-three-d"]').addClass('d-none').prop('checked',false);$('input[name="posid"]').prop('value','');$('input[name="cctype"]').prop('value','1');$('.payment-credit-card').removeClass('d-flex');},changeCreditCardBankLogo:function(paymentGateway){$('.card-logo > img').removeClass('d-none').attr('src',paymentGateway.logo_path);$('.card-logo > i').addClass('d-none');},changeCardTypeLogo:function(binSettings){$("#visa-card-logo, #master-card-logo,  #amex-logo, #troy-logo").addClass('d-none');if(binSettings.cardAssociation=='VISA'){$("#visa-card-logo").removeClass('d-none');$('input[name="cctype"]').val(1);}else if(binSettings.cardAssociation=='MASTER_CARD'){$("#master-card-logo").removeClass('d-none');$('input[name="cctype"]').val(2);}else if(binSettings.cardAssociation=='AMERICAN_EXPRESS'&&binSettings.bankCode=='62'){$("#amex-logo").removeClass('d-none');$('input[name="cctype"]').val(3);}else if(binSettings.cardAssociation=='TROY'){$("#troy-logo").removeClass('d-none');$('input[name="cctype"]').val(1);}else{$("#visa-card-logo").removeClass('d-none');$('input[name="cctype"]').val(1);}
$('.payment-credit-card').addClass('d-flex');},changeCreditCardForm:function(paymentGateway){var formSettings=paymentGateway.form_settings;$("#idea-pay-form").attr('action',paymentGateway.form_url);var threeDStatus='passive';if(typeof formSettings.three_d_status!='undefined'){threeDStatus=formSettings.three_d_status;}
if(formSettings.has_form==false){$("[id^='creditCard']").attr("disabled",true);$('[data-selector="common-payment-info"]').removeClass('d-none');$('[data-selector="reset-cart-number"]').removeClass('d-none');if(IdeaApp.member.paymentIndex.masterpassStatus){$('#masterpass-save-card-form').addClass('d-none');$('input[name="ccnumber"]').removeClass('validate-error').next('label.validate-error').remove();}}else{$("[id^='creditCard']").attr("disabled",false);$('[data-selector="common-payment-info"]').addClass('d-none');if(threeDStatus=='optional'){$('[data-selector="optional-three-d"]').removeClass('d-none');}else{$('[data-selector="optional-three-d"]').addClass('d-none');}}
$("#idea-pay-form").find('input[name="three_d_status"]').val(threeDStatus);},resetCartNumber:function(){$("[id^='creditCard']").attr("disabled",false);$('[data-selector="common-payment-info"]').addClass('d-none');$('[data-selector="reset-cart-number"]').addClass('d-none');$('.card-number').html(' ');if(IdeaApp.member.paymentIndex.masterpassStatus){$('#masterpass-save-card-form').removeClass('d-none');}
IdeaApp.member.paymentIndex.hideCreditCardFormElements();IdeaApp.member.paymentIndex.changeInstallmentEmptyMessage('Kartınıza özel taksit opsiyonlarını görebilmek için, lütfen kart numarasını giriniz.');},changeInstallmentEmptyMessage:function(message){$('[data-selector="installment-empty"] li div').html(message);},showCreditCardInstallmentOptions:function(binSettings,paymentGateway){var self=this;var installmentOptions=paymentGateway.installment_options;var output='';var checked='checked';if(self.mainPaymentGateway&&self.mainPaymentGateway.installment_options.length>0){if(typeof installmentOptions[0]!=='undefined'&&installmentOptions[0].count>1){for(var i=36;i>=0;i--){if(typeof installmentOptions[i]!=='undefined'){installmentOptions[i+1]=installmentOptions[i];delete installmentOptions[i];}}}
checked='';installmentOptions[0]=self.mainPaymentGateway.installment_options[0];}
if(installmentOptions.length<1||(binSettings.cardType=='DEBIT_CARD'&&installmentOptions[0].count!=1)){$('[data-selector="credit-card-installment-box"] [data-selector="installment-empty"]').removeClass('d-none');$('[data-selector="credit-card-installment-box"] [data-selector="installment-hall"]').html('');self.changeInstallmentEmptyMessage('Siparişiniz için bu banka üzerinde ödeme seçeneği mevcut değildir. Lütfen farklı bir banka seçiniz.');return;}
if(installmentOptions.length>0){output+=' \
                        <li> \
                            <div class="row"> \
                                <div class="col-6 col-md-8"> </div>\
                                <div class="col-3 col-md-2 text-right">Aylık</div> \
                                <div class="col-3 col-md-2 text-right">Toplam</div> \
                            </div> \
                        </li>';}
for(var i=0;i<installmentOptions.length;i++){var installmentOption=installmentOptions[i];var monthlyPrice,installmentInfo;var installmentLang=$('[data-selector="installment-hall"]').attr('data-installment-lang');if(installmentOption.count==1){monthlyPrice='-';if(installmentOption.extra_installment>0){monthlyPrice=installmentOption.monthly_price+' '+installmentOption.currency;installmentInfo=installmentOption.count+'+<b>'+installmentOption.extra_installment+'</b>'+' '+installmentLang;}else{installmentInfo=$('[data-selector="installment-hall"]').attr('data-first-installment-lang');}}else{monthlyPrice=installmentOption.monthly_price+' '+installmentOption.currency;if(installmentOption.extra_installment>0){installmentInfo=installmentOption.count+'+<b>'+installmentOption.extra_installment+'</b>'+' '+installmentLang;}else{installmentInfo=installmentOption.count+' '+installmentLang;}}
var paidPrice=installmentOption.paid_price+' '+installmentOption.currency;output+='\
                    <li> \
                        <div class="row"> \
                            <div class="col-6 col-md-8"> \
                                <div class="radio-custom"> \
                                    <input type="radio" id="credit-card-installment'+installmentOption.count+'" name="inst" data-converted-paid-price="'+installmentOption.converted_paid_price+'" value="'+installmentOption.count+'" '+checked+'/> \
                                    <label for="credit-card-installment'+installmentOption.count+'"> \
                                        '+installmentInfo+'\
                                    </label> \
                                </div> \
                            </div> \
                            <div class="col-3 col-md-2 text-right"> \
                                <strong>'+monthlyPrice+'</strong> \
                            </div> \
                            <div class="col-3 col-md-2 text-right"> \
                                <strong>'+paidPrice+'</strong> \
                            </div> \
                        </div> \
                    </li>';checked='';if(binSettings.cardType=='DEBIT_CARD'){break;}}
$('[data-selector="installment-empty"]').addClass('d-none');$('[data-selector="installment-hall"]').slideDown(100).removeClass('d-none');$('[data-selector="installment-hall"]').html(output);},changeCartBox:function(element){var value=element.val();if(element.attr('name')=='cvc2'){$('.card-cvc').html(value);}else if(element.attr('name')=='ccmonth'){$('.card-month').html(value);}else if(element.attr('name')=='ccyear'){$('.card-year').html(value);}},paymentFormSubmit:function(){var self=this;var activeForm=$("#idea-pay-form");if(self.masterpassStatus==true&&self.masterpass.hasRegisteredCard==true){self.masterpass.validationMasterpassForm();return;}
if(activeForm.valid()&&self.agreementValid()){var submitButton=$('[data-selector="payment-submit-button"]');var installment=$('input[name="inst"][checked]').val();if(self.mainPaymentGateway!=null){installment=$('input[name="inst"]:checked').val();}
if(typeof installment=='undefined'){IdeaApp.plugins.notification('Siparişiniz için bu banka üzerinde ödeme seçeneği mevcut değildir. Lütfen farklı bir banka seçiniz.','warning');submitButton.removeAttr('disabled').removeClass('btn-loading');return;}
if(self.masterpassStatus&&$('input[name="masterpass-save"]').is(':checked')){self.masterpass.validationMasterpassForm();return;}
submitButton.attr('disabled','disabled').addClass('btn-loading');var cardNumber=$('input[name="ccnumber"]').val().replace(/\s+/g,"");$('input[name=ccno1]').val(cardNumber.substr(0,4));$('input[name=ccno2]').val(cardNumber.substr(4,4));$('input[name=ccno3]').val(cardNumber.substr(8,4));$('input[name=ccno4]').val(cardNumber.substr(12,4));var threeDStatus=activeForm.find('input[name="three_d_status"]');var thirdPartyProviders=['Paynet','Wirecard','PayTR','Paytrek','Hepsipay','BoschSanalPos','TurkPara','PayU','Ipara','Segment'];if((!thirdPartyProviders.includes(IdeaApp.member.paymentIndex.paymentGateway.provider_type))&&threeDStatus.length>0&&(threeDStatus.val()=='passive'||(threeDStatus.val()=='optional'&&!jQuery('#use3d').is(':checked')))){grecaptcha.execute();}else{activeForm.submit();}}},toggle:function(element){var elementParent=element.parents('.agreement-container');if(elementParent.hasClass('active')){elementParent.removeClass('active');}else{elementParent.parents().find('.agreement-container').removeClass('active');elementParent.addClass('active');}},agreementValid:function(){var element=$('#agreement');if(element.length==0){return true;}
if(element.is(':checked')){$('#agreement').parents('.checkbox-custom').removeClass('no-valid-agreement');$('#agreement').parents('.checkbox-custom').next('div.validate-error').remove();return true}else{$('#agreement').parents('.checkbox-custom').next('div.validate-error').remove();$('#agreement').parents('.checkbox-custom').addClass('no-valid-agreement').after('<div class="validate-error mt-0">Lütfen alışverişsiz ödeme sistemi sözleşmesini onaylayınız.</div>');return false}},loadCreditCardSettings:function(binNumber){var self=this;if(self.binCache==binNumber){return;}
self.binCache=binNumber;IdeaApp.plugins.loadingBar.show();$('[data-selector="credit-card-installment-box"] ul').addClass('d-none');$.ajax({type:"POST",url:IdeaApp.routing.generate("/idea-pay/settings"),data:{'bin_number':binNumber,'amount':$('#amount').val(),'currency':$('#currency').val(),'anticsrf':anticsrf},success:function(response){if(response.success){var paymentGateway=response.data.payment_gateway;var binSettings=response.data.bin_settings;self.mainPaymentGateway=response.data.main_payment_gateway;self.paymentGateway=paymentGateway;self.binSettings=binSettings;self.masterpass.checkProviderType();var posAccountId=self.getCurrentCreditCardGateway().pos_account_id;$('input[name="posid"]').val(posAccountId);self.changeCreditCardBankLogo(paymentGateway);self.changeCardTypeLogo(binSettings);self.changeCreditCardForm(paymentGateway);self.showCreditCardInstallmentOptions(binSettings,paymentGateway);}else{self.changeInstallmentEmptyMessage('Siparişiniz için bu banka üzerinde ödeme seçeneği mevcut değildir. Lütfen farklı bir banka seçiniz.');self.hideCreditCardFormElements();}
IdeaApp.plugins.loadingBar.hide();},error:function(){this.changeInstallmentEmptyMessage('Siparişiniz için bu banka üzerinde ödeme seçeneği mevcut değildir. Lütfen farklı bir banka seçiniz.');this.hideCreditCardFormElements();IdeaApp.plugins.loadingBar.hide();}});},getCurrentCreditCardGateway:function(){var creditCardInstallment=$('input[name="inst"]:checked').val();var currentPaymentGateway=this.paymentGateway;if(creditCardInstallment=='1'&&this.mainPaymentGateway){currentPaymentGateway=this.mainPaymentGateway;}
return currentPaymentGateway;},eventListener:function(){var self=this;$(document).on('keyup','#amount',function(){self.changeAmount($(this));self.hideCreditCardFormElements();});$(document).on('keyup','input[name="ccname"]',function(){$('.card-name').html($(this).val());});$('input[name="cvc2"]').payment('formatCardCVC');$(document).on('keyup','input[name="cvc2"]',function(){self.changeCartBox($(this));});$('input[name="ccnumber"]').payment('formatCardNumber');$('input[name="ccnumber"]').bind("input keyup mouseup keyup cut copy paste",function(){self.changeCreditCardNumber($(this));});$(document).on('change','select[name="ccmonth"], select[name="ccyear"]',function(){self.changeCartBox($(this));});$(document).on('change','#add-payment-note',function(){if($(this).is(':checked')){$('#payment-note-content').slideDown();}else{$('#payment-note-content').slideUp();}});$(document).on('click','[data-selector="payment-submit-button"]',function(){self.paymentFormSubmit();});$(document).on('click','[data-selector="agreement-toggle"]',function(){self.toggle($(this));});$(document).on('change','#agreement',function(){self.agreementValid();});$(document).on('click','[data-selector="reset-cart-number"]',function(){self.resetCartNumber();});$(document).on('click','[data-selector="change-amount"]',function(){location.reload();});$(document).on('change','#currency',function(){self.changeCurrency();});$(document).on('click','input[name="inst"]',function(){self.changeInstallment();});}},paymentSuccess:{paymentId:null,init:function(){this.setPaymentId();this.checkAndShowMasterpassModal();this.eventListener();},setPaymentId:function(){this.paymentId=$('.payment-success').attr('data-payment-id');},checkAndShowMasterpassModal:function(){if($('#masterpass-success').length==0){return;}
$.fancybox.open({src:'#masterpass-success',touch:false});},printPaymentReceipt:function(element){var url='/hesabim/odeme-dekontu-yazdir?paymentId='+this.paymentId;IdeaApp.helpers.print(element,IdeaApp.routing.generate(url));},eventListener:function(){var self=this;$(document).on('click','[data-selector="print-payment-receipt"]',function(){self.printPaymentReceipt($(this));});}},eventListener:function(){$(document).on('click','[data-selector="show-action-button"]',function(){$(this).next('.table-list-action-button-content').toggleClass('show');});$('body').on('click',function(e){if(!$('.table-list-action-button').is(e.target)&&$('.table-list-action-button-content').has(e.target).length===0){$('.table-list-action-button-content').removeClass('show');}});$(document).on('click','.custom-responsive-table-pagination a:not(.disabled):not(.active)',function(){IdeaApp.plugins.dataGrid.pagination($(this));});}}}($,window));function iyzicoEventBeforePayment(){IdeaApp.member.paymentIndex.iyzico.checkSession();if(!IdeaApp.member.paymentIndex.iyzico.isReadyToSubmit()){IdeaApp.plugins.notification('Iyzico servislerine bağlanılamadı. Lütfen daha sonra tekrar deneyiniz.','error');setTimeout(function(){window.location.reload();},5000);throw 'stop';}}
function iyzicoEventWhenErrorOccured(error){IdeaApp.plugins.notification(error,'error');}
function reCaptchaPaymentSubmit(token){$("#idea-pay-form").append("<input name='recaptcha' type='hidden' value='"+token+"'>");$("#idea-pay-form").submit();}
function reCaptchaSignUpSubmit(token){$("#signup-form").append("<input name='recaptcha' type='hidden' value='"+token+"'>");}
function reCaptchaBankTransferSubmit(token){$("#bank-transfer-form").append("<input name='recaptcha' type='hidden' value='"+token+"'>");}
function reCaptchaTicketSubmit(token){$("#add-ticket-form").append("<input name='recaptcha' type='hidden' value='"+token+"'>");}
function reCaptchaTicketDetailSubmit(token){$("#addReplyForm").append("<input name='recaptcha' type='hidden' value='"+token+"'>");}
function forgotPassSubmit(token){$("#forgot-password-form").append("<input name='recaptcha' type='hidden' value='"+token+"'>");}